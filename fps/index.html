<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>my Game</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />
<style>
* { margin: 0; padding: 0; border: 0; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: -moz-none; -o-user-select: none; user-select: none; box-sizing: border-box; }
html { width:100%; height:100% }
body { 
    font-family: "Lucida Console", Monaco, monospace;
    font-size: 11px; 
    color:#fff;
    background: #000000; 
    /*overflow:hidden;*/
}
#debug { }
</style>

<script src="js/three.min.js"></script>
<script src="js/sea3d.min.js"></script>

<script src="js/zoll.min.js"></script>

</head>
<body>
<script>

   var stats = null;

    var demo = 1;

    var d, t;
    function addtell () { 
        d = document.createElement( 'div' );
        d.style.cssText = 'position:absolute; top:0; left:0; text-align:left; padding: 10px 10px; pointer-events:none; width:100%; color:#0F0; ';
        document.body.appendChild( d );
    };
    function tell ( s ) { d.innerHTML += s + '<br>'; };
    function trace ( s ) { if(d) d.innerHTML = s; };

    


    view.init();
    user.init();

    addtell();
    map.init();
    cam.init();
    hub.init();

    /*var butt = document.createElement( 'div' );
    butt.style.cssText = 'position: absolute; cursor: pointer; bottom: 10px; left: 10px; width: 100px; border:1px solid #FFFFFF;';
    butt.innerHTML = 'SNAPSHOOT'
    document.body.appendChild( butt );

    butt.addEventListener('click', view.snapShoot, false );*/

    


    pool.load(['models/basic.sea', 'models/bob.sea', 'models/museum.sea', 'textures/spherical/smooth.jpg','textures/museum/facade.png', 'textures/museum/escalator.png', 'textures/museum/bigwall.jpg', 'textures/museum/floor.jpg', 'textures/museum/floor2.jpg' ], init );

    function init ( p ) {

        var sc = 1;//1.23;
        var y = 0;//3.27*sc;
        var names;
        var types;
        var level = [];
        var material = [];

        if(demo === 1 ) {

            sc = 1;
            y = 3.27// * sc;

            view.setDeep( sc*10 );
            view.setDecal( 3.27 );

            var envMap =  new THREE.Texture( p.smooth );
            envMap.mapping = THREE.SphericalReflectionMapping;
            envMap.needsUpdate = true;

            var t = new THREE.Texture( p.facade );
            t.flipY = false;
            t.needsUpdate = true;
            material[0] = new THREE.MeshLambertMaterial({ map:t, envMap:envMap, reflectivity:0.6  });
            material[2] = new THREE.MeshLambertMaterial({ map:t, transparent:true, side:THREE.DoubleSide, envMap:envMap, reflectivity:0.8 });
            t = new THREE.Texture( p.escalator );
            t.flipY = false;
            t.needsUpdate = true;
            material[1] = new THREE.MeshLambertMaterial({ map:t, envMap:envMap, reflectivity:0.6 });
            material[3] = new THREE.MeshLambertMaterial({ map:t, transparent:true, side:THREE.DoubleSide, envMap:envMap, reflectivity:0.8 });

            t = new THREE.Texture( p.floor );
            t.flipY = false;
            t.needsUpdate = true;
            material[4] = new THREE.MeshLambertMaterial({ map:t, envMap:envMap, reflectivity:0.6 });

            t = new THREE.Texture( p.bigwall );
            t.flipY = false;
            t.needsUpdate = true;
            material[5] = new THREE.MeshLambertMaterial({ map:t, envMap:envMap, reflectivity:0.6 });

            t = new THREE.Texture( p.floor2 );
            t.flipY = false;
            t.needsUpdate = true;
            material[6] = new THREE.MeshLambertMaterial({ map:t, envMap:envMap, reflectivity:0.6 });
            
            //view.addCollision( p['museum']['floor_0'], sc, {y:y} );
            //view.addCollision( p['museum']['floor_1'], sc, {y:y} );

            names = ['facade', 'elevator','facade_w','elevator_w','floor','bigwall', 'floor2', 'floor_0', 'floor_1'];
            types = [        0,   3, 0, 0, 3, 0, 3, 2, 2];
            level = [       -1,  -1,-1,-1,-1,-1,-1, 0, 1 ];

        } else {

            view.setDeep( 10 );
            view.setDecal( y );

            //map.add( p['basic']['collision'], sc, {y:y} );

            //view.addCollision( p['basic']['collision'], sc, {y:y} );
            names = ['sea', 'hh'];
            types = [    0,    1];

        }

       
        var i = names.length, m, name;
        while(i--){

            name = names[i];
            if(demo === 1 ) m = p['museum'][names[i]];
            else m = p['basic'][names[i]];

            view.add( m, { size:sc, pos:[0,y,0], type:types[i], level:level[i], material:material[i] } );

        }

        player.init( p['bob']['bob'] );

    }

</script>
</body>
</html>