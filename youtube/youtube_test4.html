<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>YouTube Player</title>
</head>
<body>
<form class="form-download" >
    <input type="text" class="form-control" name="videoid" id="videoid" size="40" placeholder="Video ID"></div>
   <!--  <input class="btn btn-primary btn-lg btn-block" type="submit" name="type" id="type" value="redirect" onClick="testResults(this.form)">-->
   <input class="btn btn-primary btn-lg btn-block" type="button" name="type" value="Click" onClick="testResults(this.form)">
</form>
<LINK rel="Prev"  href="">
<!--<video id='videoPlayer' controls="true" preload="auto">
    <source id='mp4Source' src="" type="video/mp4" />
</video>-->

<!--<video src="youtu.be/gdt_r9O6n9o" controls="true"></video>-->

<script>
var txt= document.createElement('div');
txt.style.border = '1px solid #F00';
var URL = window.URL || window.webkitURL
var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')

document.body.appendChild(svg)
//var player= document.getElementById('videoPlayer');
//var source = document.getElementById('mp4Source');
var player = document.createElement('video');
document.body.appendChild(player)
document.body.appendChild(txt)
var cc = document.createElement('canvas');
cc.width = 320;
cc.height = 180;
document.body.appendChild(cc)

var ctx = cc.getContext("2d");
//cc.toBlob(function(my_file){
  //.toBlob is only implemented in > FF18 but there is a polyfill 
  //for other browsers https://github.com/blueimp/JavaScript-Canvas-to-Blob
  //var myBlob = (my_file);
//})
function testResults(form){
    var value = form.videoid.value;
    if(value == '') return;

    if(value.substring(0,3)=='YT:' || value.substring(0,3)=='yt:' ){ 
     // var blobUrl = URL.createObjectURL(new Blob(['Test'], {type: 'text/plain'}));
      var url = 'http://youtube-download.bl.ee/getvideo.mp4?videoid='+value.substring(3)+'&format=ipad';
      var url2 = 'http://youtube-download.bl.ee/getvideo.mp4?videoid='+value.substring(3)+'&format=ipad';//+'&format=best';

      var ll = document.createElement('a');
document.body.appendChild(ll)

ll.download = 'nono.json';//container.querySelector('input[type="text"]').value;
        ll.href = url;//window.URL.createObjectURL(bb);
        ll.textContent = 'Download ready';
        //a.className = 'saveout'

        ll.dataset.downloadurl = ['text/plain', ll.download, ll.href].join(':');
        ll.draggable = true;





var links = document.getElementsByTagName("link")
links[0].setAttribute("href", url2);
console.log(links[0].href)
     var xhr = new XMLHttpRequest();
     xhr.open('GET', url2, true);
  //    xhr.open('GET', url2, true)
    //  xhr.responseType = 'arraybuffer';
      xhr.responseType = 'blob';
      //xhr.responseType = "arraybuffer";
      //embedpage(xhr)
      xhr.onload = function(e) {
        if (xhr.status == 200) {
        //var xmlDoc = xhr.responseXML;
        console.log(xhr.response)//.responseText)
}
      }

      //xhr.open('GET', url );
    xhr.send();
 /*
function embedpage(request){
//if viewing page offline or the document was successfully retrieved online (status code=2000)
if (window.location.href.indexOf("http")==-1 || request.status==200)
  // document.write(request.responseText)
console.log(request.responseText)
}*/


//      localStorage.setItem("video",url)
    //  console.log(localStorage.video);

      //var fileURL = URL.createObjectURL(url);
      //console.log(fileURL)
        //source.src = "http://youtube-download.bl.ee/getvideo.php?videoid="+value.substring(3)+"&type=redirect";
        player.src = url;//localStorage.video;

        player.load();
       player.play();

       // txt.innerHTML = SVGHACK.Logo('http://farm1.static.flickr.com/234/535566372_33c1025c7b_o.jpg');
//svg.src =SVGHACK.Logo('http://farm1.static.flickr.com/234/535566372_33c1025c7b_o.jpg');

 
        player.onplay = function(){
          //console.log(player)
            timerCallback()
           // console.log(player)
           
        }
    }
}

function computeFrame() {
    ctx.drawImage(player, 0, 0, 320,180);
  //   ctx.getImageData(0,0,320,180);
   // var xhtmlNS = "http://www.w3.org/1999/xhtml";

    //var context = svg.getElementsByTagNameNS(xhtmlNS,'canvas')[0].getContext('2d');
    //context.fillStyle = 'rgba(90,200,0,0.7)';
    //context.fillRect(0,0,100,75);
   // context.drawImage(player, 0, 0, 320,180);
   //  txt.innerHTML = SVGHACK.Logo( cc.toDataURL( ) );
}
function timerCallback() {
    if (player.paused || player.ended) {
      return;
    }
    computeFrame();
    
    setTimeout(function () { timerCallback() }, 0);
  }


var SVGHACK = {}
SVGHACK.Logo = function(url, size){
    var width = size || 256;
    var Kwidth = '0 0 256 256';
    var t = [];
    t[0] = "<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='256px' height='256px' viewBox='0 0 256 256'>";
    t[1] = "<foreignObject x='0' y='0' width='256' height='256'><xhtml:canvas width='256' height='256' id='thisCanvas'></xhtml:canvas></foreignObject>";
    

   // t[0] = "<svg version='1.2' baseProfile='tiny' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' preserveAspectRatio='none' x='0px' y='0px' width='"+width+"px' height='"+width+"px' viewBox='"+Kwidth+"';'><g>";
    //t[1] = "<circle cx='0' cy='0' r='170' fill='#da4' fill-opacity='0.3'/>";
   // t[2] = "<video id='vid1' xlink:href="+url+" type='video/mp4' x='0' y='0' width='256' height='256' begin='0s' syncBehavior='independent' repeatCount='indefinite' externalResourcesRequired ='true'/>";
   // t[2] = "<video xlink:href='fingers.mp4' width='256' heigth='256' begin='0s' syncBehavior='independent' repeatCount='indefinite'/>";
   //t[3] ="<image id='bar' preserveAspectRatio='xMidYMid' x='0' y='0' width='500' height='500' xlink:href='http://farm1.static.flickr.com/234/535566372_33c1025c7b_o.jpg'/>";
   t[2] ="<g><image id='bar' preserveAspectRatio='xMidYMid' x='0' y='0' width='500' height='500' xlink:href='"+url+"'/>"
   t[3] = "<circle cx='0' cy='0' r='190' fill='#da4' fill-opacity='0.3'/></g>";

    t[4] = "<script type='text/javascript'><![CDATA[window.onload = function () { var xhtmlNS = 'http://www.w3.org/1999/xhtml'; var context = document.getElementsByTagNameNS( xhtmlNS,'canvas')[0].getContext('2d');context.fillStyle = 'rgba(0,200,0,0.7)';context.fillRect(0,0,100,75); };]]/>"

    t[5] = "</svg>";
    return t.join("\n");
}
//YT:gdt_r9O6n9o
//YT:WVE_yU38YVI
//YT:xfJHv4LzszQ
//YT:73QVIj3bzeY
</script>
</body>
</html>
