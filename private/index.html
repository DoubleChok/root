<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Rondo</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />
<style>
* { margin: 0; padding: 0; border: 0; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: -moz-none; -o-user-select: none; user-select: none; }
body { 
    font-family: "Lucida Console", Monaco, monospace;
    font-size: 11px; 
    color:#fff;
    background: #000000; 
    overflow:hidden; 
}

.debug { font-family:"Lucida Console", Monaco, monospace; position:absolute; font-size:16px;  top:10px; left:10px; text-align:left; pointer-events:none; width:300px;}

</style>


<script src="js/three.min.js"></script>
<script src="js/sea3d.min.js"></script>
<script src="js/uil.min.js"></script>
<script src="js/pool.js"></script>
<script src="js/controls/OrbitControls.js"></script>

</head>
<body>

<script>

    var camera, scene, renderer, controler;
    
    var meshs = {};
    var mat = {};
    var txt = {};

    var torad = 0.0174532925199432957;

    init();
    animate();

    function init() {

        camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
        camera.position.z = 100;

        scene = new THREE.Scene();

        /*var texture = new THREE.TextureLoader().load( 'assets/textures/rondo.jpg' );

        var geometry = new THREE.BoxBufferGeometry( 200, 200, 200 );
        var material = new THREE.MeshBasicMaterial( { map: texture } );

        mesh = new THREE.Mesh( geometry, material );
        scene.add( mesh );*/

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );

        renderer.setClearColor( 0xffd400, 1 );

        controler = new THREE.OrbitControls( camera, renderer.domElement );

        //

        window.addEventListener( 'resize', onWindowResize, false );


        pool.load( ['assets/textures/rondo_m.jpg', 'assets/textures/rondo_w.jpg', 'assets/models/rondoid.sea'], onLoadComplete );

    }

    function onLoadComplete( p ) {

        txt['man'] = new THREE.Texture( p.rondo_m );
        txt['man'].flipY = false;
        txt['man'].needsUpdate = true;

        txt['wom'] = new THREE.Texture( p.rondo_w );
        txt['wom'].flipY = false;
        txt['wom'].needsUpdate = true;

        mat['skin0'] = new THREE.MeshBasicMaterial({ map:txt.man, skinning:true });
        mat['base0'] = new THREE.MeshBasicMaterial({ map:txt.man });

        mat['skin1'] = new THREE.MeshBasicMaterial({ map:txt.wom, skinning:true });
        mat['base1'] = new THREE.MeshBasicMaterial({ map:txt.wom });

        var m = pool.meshByName ( 'rondoid' );

        meshs['body'] = m.body;
        meshs['head'] = m.head;
        meshs['corps'] = m.corps;
        meshs['extra_man'] = m.extra_man;
        meshs['extra_wom'] = m.extra_wom;

        //meshs.extra_wom.visible = false;

        /*meshs.body.material = mat.skin;
        meshs.head.material = mat.base;
        meshs.corps.material = mat.base;
        meshs.extra_man.material = mat.base;
        meshs.extra_wom.material = mat.base;*/

        addModel('man', new THREE.Vector3(40, -20, 0 ) );
        addModel('wom', new THREE.Vector3(-40, -20, 0 ) );

    }

    function addModel ( type, pos ) {

        var m = meshs.body.clone();

        var b = m.skeleton.bones;

        var a0 = meshs.corps.clone();
        a0.rotation.set(180*torad,180*torad, 0*torad );

        var a1 = meshs.head.clone();
        a1.rotation.set(180*torad,180*torad, 0*torad );

        var a2 = type === 'man' ? meshs.extra_man.clone() : meshs.extra_wom.clone()

        a1.add(a2);

        console.log(b)

        



        m.material = type === 'man' ? mat.skin0 : mat.skin1;
        a0.material = type === 'man' ? mat.base0 : mat.base1;
        a1.material = type === 'man' ? mat.base0 : mat.base1;
        a2.material = type === 'man' ? mat.base0 : mat.base1;

        b[0].add(a0);
        b[6].add(a1);

        if(type === 'man') m.play(0);
        else m.play(1);
        m.position.copy( pos );

        scene.add( m )




    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    function animate() {

        requestAnimationFrame( animate );
        THREE.SEA3D.AnimationHandler.update( 0.007 );
        renderer.render( scene, camera );

    }


</script>
</body>
</html>
