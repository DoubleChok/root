'use strict';var DDLS={EPSILON:0.01,EPSILON_SQUARED:1E-4,SegmentID:0,ShapeID:0,EdgeID:0,FaceID:0,MeshID:0,ObjectID:0,VertexID:0,GraphID:0,GraphEdgeID:0,GraphNodeID:0};DDLS.sqrt=Math.sqrt;DDLS.cos=Math.cos;DDLS.sin=Math.sin;DDLS.atan2=Math.atan2;DDLS.round=Math.round;DDLS.pow=Math.pow;DDLS.max=Math.max;DDLS.min=Math.min;DDLS.random=Math.random;DDLS.lerp=function(a,b,c){return a+(b-a)*c};DDLS.randInRange=function(a,b){return DDLS.lerp(a,b,DDLS.random())};
DDLS.randInt=function(a,b,c){return 1*DDLS.lerp(a,b,DDLS.random()).toFixed(c||0)};DDLS.PI=3.141592653589793;DDLS.TwoPI=6.283185307179586;DDLS.PI90=0.5*DDLS.PI;DDLS.PI270=DDLS.PI+DDLS.PI90;DDLS.ToRad=DDLS.PI/180;DDLS.ToDeg=180/DDLS.PI;DDLS.NaN=Number.NaN;DDLS.NEGATIVE_INFINITY=-Infinity;DDLS.POSITIVE_INFINITY=Infinity;DDLS.isFinite=function(a){return isFinite(a)};DDLS.isNaN=function(a){return isNaN(a)};DDLS.int=function(a){return a|0};DDLS.Log=function(a){console.log(a)};DDLS.Debug={};
DDLS.Debug.assertTrue=function(a,b,c){a||console.error(c.fileName+":"+c.lineNumber+": Expected true but was false! "+(null!=b?b:""))};DDLS.Debug.assertFalse=function(a,b,c){a&&console.error(c.fileName+":"+c.lineNumber+": Expected false but was true! "+(null!=b?b:""))};DDLS.Debug.assertEquals=function(a,b,c,d){b!=a&&console.error(d.fileName+":"+d.lineNumber+": Expected '"+a.toString()+"' but was '"+b.toString()+"' "+(null!=c?c:""))};DDLS.Debug.trace=function(a,b){console.log(a,b)};
DDLS.StringMap=function(){this.h={}};DDLS.StringMap.prototype={set:function(a,b){this.h[a]=b},get:function(a){return this.h[a]}};DDLS.Fid=0;DDLS.Bind=function(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=DDLS.Fid++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c};DDLS.StringTools=function(){};
DDLS.StringTools.hex=function(a,b){var c="";do c="0123456789ABCDEF".charAt(a&15)+c,a>>>=4;while(0<a);if(null!=b)for(;c.length<b;)c="0"+c;return c};DDLS.Bytes=function(a,b){this.length=a;this.b=b};DDLS.Bytes.alloc=function(a){for(var b=[],c=0;c<a;)c++,b.push(0);return new DDLS.Bytes(a,b)};DDLS.Timer=function(){};DDLS.Timer.stamp=function(){return void 0!==self.performance&&void 0!==self.performance.now?0.001*self.performance.now():0.001*Date.now()};
DDLS.Intersection={__ename__:!0,__constructs__:["EVertex","EEdge","EFace","ENull"]};DDLS.Intersection.EVertex=function(a){a=["EVertex",0,a];a.__enum__=DDLS.Intersection;return a};DDLS.Intersection.EEdge=function(a){a=["EEdge",1,a];a.__enum__=DDLS.Intersection;return a};DDLS.Intersection.EFace=function(a){a=["EFace",2,a];a.__enum__=DDLS.Intersection;return a};DDLS.Intersection.ENull=["ENull",3];DDLS.Intersection.ENull.__enum__=DDLS.Intersection;
DDLS.Dictionary=function(a){this.overwrite=!0==a;this.k=[];this.v=[]};
DDLS.Dictionary.prototype={set:function(a,b){this.overwrite&&-1!=this.k.indexOf(a)||(this.k.push(a),this.v.push(b))},get:function(a){a=this.k.indexOf(a);if(-1!=a)return this.v[a]},remove:function(a){a=this.k.indexOf(a);-1!=a&&(this.k.splice(a,1),this.v.splice(a,1))},clearAll:function(a){for(var b=0;b<this.v.length;b++)this.v[b]==a&&(this.k.splice(b,1),this.v.splice(b,1))},iterate:function(a){for(var b=0;b<this.k.length;b++)a(this.k[b],this.v[b])}};DDLS.Point=function(a,b){this.x=a||0;this.y=b||0};
DDLS.Point.prototype={constructor:DDLS.Point,transform:function(a){a.tranform(this)},set:function(a,b){this.x=a;this.y=b},setXY:function(a,b){this.x=a;this.y=b},clone:function(){return new DDLS.Point(this.x,this.y)},substract:function(a){this.x-=a.x;this.y-=a.y},get_length:function(){return DDLS.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.get_length();this.x/=a;this.y/=a},scale:function(a){this.x*=a;this.y*=a},distanceTo:function(a){var b=this.x-a.x;a=this.y-a.y;return DDLS.sqrt(b*
b+a*a)},distanceSquaredTo:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a}};DDLS.Matrix=function(a,b,c,d,e,f){this.a=a||0;this.b=b||0;this.c=c||0;this.d=d||0;this.e=e||0;this.f=f||0};
DDLS.Matrix.prototype={constructor:DDLS.Matrix,identity:function(){this.a=1;this.c=this.b=0;this.d=1;this.f=this.e=0},translate:function(a,b){this.e+=a;this.f+=b},scale:function(a,b){this.a*=a;this.b*=b;this.c*=a;this.d*=b;this.e*=a;this.f*=b},rotate:function(a){var b=DDLS.cos(a);a=DDLS.sin(a);var c=this.a*a+this.b*b,d=this.c*b+this.d*-a,e=this.c*a+this.d*b,f=this.e*b+this.f*-a,n=this.e*a+this.f*b;this.a=this.a*b+this.b*-a;this.b=c;this.c=d;this.d=e;this.e=f;this.f=n},clone:function(){return new DDLS.Matrix(this.a,
this.b,this.c,this.d,this.e,this.f)},tranform:function(a){var b=this.b*a.x+this.d*a.y+this.f;a.x=this.a*a.x+this.c*a.y+this.e;a.y=b},transformX:function(a,b){return this.a*a+this.c*b+this.e},transformY:function(a,b){return this.b*a+this.d*b+this.f},concat:function(a){var b=this.a*a.b+this.b*a.d,c=this.c*a.a+this.d*a.c,d=this.c*a.b+this.d*a.d,e=this.e*a.a+this.f*a.c+a.e,f=this.e*a.b+this.f*a.d+a.f;this.a=this.a*a.a+this.b*a.c;this.b=b;this.c=c;this.d=d;this.e=e;this.f=f}};DDLS.RandGenerator=function(a,b,c){this.rangeMin=b||0;this.rangeMax=c||1;this._originalSeed=this._currSeed=a||1234;this._numIter=0;Object.defineProperty(this,"seed",{get:function(){return this._originalSeed},set:function(a){this._originalSeed=this._currSeed=a}})};
DDLS.RandGenerator.prototype={constructor:DDLS.RandGenerator,reset:function(){this._currSeed=this._originalSeed;this._numIter=0},next:function(){var a=1*this._currSeed;for(this._tempString=(a*a).toString();8>this._tempString.length;)this._tempString="0"+this._tempString;this._currSeed=parseInt(this._tempString.substr(1,5));a=DDLS.round(this.rangeMin+this._currSeed/99999*(this.rangeMax-this.rangeMin));0==this._currSeed&&(this._currSeed=this._originalSeed+this._numIter);this._numIter++;200==this._numIter&&
this.reset();return a},nextInRange:function(a,b){this.rangeMin=a;this.rangeMax=b;return this.next()},shuffle:function(a){for(var b=a.length;0<b;){var c=this.nextInRange(0,b-1);b--;var d=a[b];a[b]=a[c];a[c]=d}}};DDLS.Edge=function(){this.colorDebug=-1;this.id=DDLS.EdgeID;DDLS.EdgeID++;this.fromConstraintSegments=[];this.isReal=this.isConstrained=!1;this.leftFace=this.nextLeftEdge=this.oppositeEdge=this.originVertex=null;Object.defineProperty(this,"destinationVertex",{get:function(){return this.oppositeEdge.originVertex}});Object.defineProperty(this,"nextRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge.nextLeftEdge.oppositeEdge}});Object.defineProperty(this,"prevRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge.oppositeEdge}});
Object.defineProperty(this,"prevLeftEdge",{get:function(){return this.nextLeftEdge.nextLeftEdge}});Object.defineProperty(this,"rotLeftEdge",{get:function(){return this.nextLeftEdge.nextLeftEdge.oppositeEdge}});Object.defineProperty(this,"rotRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge}});Object.defineProperty(this,"rightFace",{get:function(){return this.oppositeEdge.leftFace}})};
DDLS.Edge.prototype={constructor:DDLS.Edge,setDatas:function(a,b,c,d,e,f){this.isConstrained=void 0!==e?f:!1;this.isReal=void 0!==e?e:!0;this.originVertex=a;this.oppositeEdge=b;this.nextLeftEdge=c;this.leftFace=d},addFromConstraintSegment:function(a){-1==this.fromConstraintSegments.indexOf(a)&&this.fromConstraintSegments.push(a)},removeFromConstraintSegment:function(a){a=this.fromConstraintSegments.indexOf(a);-1!=a&&this.fromConstraintSegments.splice(a,1)},dispose:function(){this.fromConstraintSegments=
this.leftFace=this.nextLeftEdge=this.oppositeEdge=this.originVertex=null},toString:function(){return"edge "+this.originVertex.id+" - "+this.destinationVertex.id}};DDLS.Face=function(){this.colorDebug=-1;this.id=DDLS.FaceID;DDLS.FaceID++};DDLS.Face.prototype={constructor:DDLS.Face,setDatas:function(a,b){this.isReal=void 0!==b?b:!0;this.edge=a},dispose:function(){this.edge=null}};DDLS.Vertex=function(){this.colorDebug=-1;this.id=DDLS.VertexID;DDLS.VertexID++;this.pos=new DDLS.Point;this.fromConstraintSegments=[];this.edge=null;this.isReal=!1};
DDLS.Vertex.prototype={constructor:DDLS.Vertex,setDatas:function(a,b){this.isReal=void 0!==b?b:!0;this.edge=a},addFromConstraintSegment:function(a){-1==this.fromConstraintSegments.indexOf(a)&&this.fromConstraintSegments.push(a)},removeFromConstraintSegment:function(a){a=this.fromConstraintSegments.indexOf(a);-1!=a&&this.fromConstraintSegments.splice(a,1)},dispose:function(){this.fromConstraintSegments=this.edge=this.pos=null},toString:function(){return"ver_id "+this.id}};DDLS.Object=function(){this.id=DDLS.ObjectID;DDLS.ObjectID++;this._pivotY=this._pivotX=0;this._matrix=new DDLS.Matrix;this._scaleY=this._scaleX=1;this._rotation=0;this._constraintShape=null;this._y=this._x=0;this._coordinates=[];this.hasChanged=!1;Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation!=a&&(this._rotation=a,this.hasChanged=!0)}});Object.defineProperty(this,"scaleX",{get:function(){return this._scaleX},set:function(a){this._scaleX!=
a&&(this._scaleX=a,this.hasChanged=!0)}});Object.defineProperty(this,"scaleY",{get:function(){return this._scaleY},set:function(a){this._scaleY!=a&&(this._scaleY=a,this.hasChanged=!0)}});Object.defineProperty(this,"x",{get:function(){return this._x},set:function(a){this._x!=a&&(this._x=a,this.hasChanged=!0)}});Object.defineProperty(this,"y",{get:function(){return this._y},set:function(a){this._y!=a&&(this._y=a,this.hasChanged=!0)}});Object.defineProperty(this,"matrix",{get:function(){return this._matrix},
set:function(a){this._matrix=a;this.hasChanged=!0}});Object.defineProperty(this,"coordinates",{get:function(){return this._coordinates},set:function(a){this._coordinates=a;this.hasChanged=!0}});Object.defineProperty(this,"constraintShape",{get:function(){return this._constraintShape},set:function(a){this._constraintShape=a;this.hasChanged=!0}});Object.defineProperty(this,"pivotX",{get:function(){return this._pivotX},set:function(a){this._pivotX=a;this.hasChanged=!0}});Object.defineProperty(this,"pivotY",
{get:function(){return this._pivotY},set:function(a){this._pivotY=a;this.hasChanged=!0}});Object.defineProperty(this,"edges",{get:function(){for(var a=[],b=this._constraintShape.segments,c=0,d=b.length;c<d;)for(var e=c++,f=0,n=b[e].edges.length;f<n;){var g=f++;a.push(b[e].edges[g])}return a}})};
DDLS.Object.prototype={constructor:DDLS.Object,dispose:function(){this._constraintShape=this._coordinates=this._matrix=null},updateValuesFromMatrix:function(){},updateMatrixFromValues:function(){this._matrix.identity();this._matrix.translate(-this._pivotX,-this._pivotY);this._matrix.scale(this._scaleX,this._scaleY);this._matrix.rotate(this._rotation);this._matrix.translate(this._x,this._y)}};DDLS.Segment=function(a,b){this.id=DDLS.SegmentID;DDLS.SegmentID++;this.edges=[];this.fromShape=null};DDLS.Segment.prototype={constructor:DDLS.Segment,addEdge:function(a){-1==this.edges.indexOf(a)&&-1==this.edges.indexOf(a.oppositeEdge)&&this.edges.push(a)},removeEdge:function(a){var b=this.edges.indexOf(a);-1==b&&(b=this.edges.indexOf(a.oppositeEdge));-1!=b&&this.edges.splice(b,1)},dispose:function(){this.fromShape=this.edges=null},toString:function(){return"seg_id "+this.id}};DDLS.Shape=function(){this.id=DDLS.ShapeID;DDLS.ShapeID++;this.segments=[]};DDLS.Shape.prototype={constructor:DDLS.Shape,dispose:function(){for(;0<this.segments.length;)this.segments.pop().dispose();this.segments=null}};DDLS.FromEdgeToRotatedEdges=function(){};DDLS.FromFaceToInnerVertices=function(){Object.defineProperty(this,"fromFace",{set:function(a){this._fromFace=a;this._nextEdge=this._fromFace.edge}})};DDLS.FromFaceToInnerVertices.prototype={next:function(){null!=this._nextEdge?(this._resultVertex=this._nextEdge.originVertex,this._nextEdge=this._nextEdge.nextLeftEdge,this._nextEdge==this._fromFace.edge&&(this._nextEdge=null)):this._resultVertex=null;return this._resultVertex}};
DDLS.FromFaceToInnerEdges=function(){Object.defineProperty(this,"fromFace",{set:function(a){this._fromFace=a;this._nextEdge=this._fromFace.edge}})};DDLS.FromFaceToInnerEdges.prototype={next:function(){null!=this._nextEdge?(this._resultEdge=this._nextEdge,this._nextEdge=this._nextEdge.nextLeftEdge,this._nextEdge==this._fromFace.edge&&(this._nextEdge=null)):this._resultEdge=null;return this._resultEdge}};
DDLS.FromFaceToNeighbourFaces=function(){Object.defineProperty(this,"fromFace",{set:function(a){this._fromFace=a;this._nextEdge=this._fromFace.edge}})};DDLS.FromFaceToNeighbourFaces.prototype={next:function(){if(null!=this._nextEdge){do if(this._resultFace=this._nextEdge.rightFace,this._nextEdge=this._nextEdge.nextLeftEdge,this._nextEdge==this._fromFace.edge){this._nextEdge=null;this._resultFace.isReal||(this._resultFace=null);break}while(!this._resultFace.isReal)}else this._resultFace=null;return this._resultFace}};
DDLS.FromMeshToVertices=function(){Object.defineProperty(this,"fromMesh",{set:function(a){this._fromMesh=a;this._currIndex=0}})};DDLS.FromMeshToVertices.prototype={next:function(){do if(this._currIndex<this._fromMesh._vertices.length)this._resultVertex=this._fromMesh._vertices[this._currIndex],this._currIndex++;else{this._resultVertex=null;break}while(!this._resultVertex.isReal);return this._resultVertex}};
DDLS.FromMeshToFaces=function(){Object.defineProperty(this,"fromMesh",{set:function(a){this._fromMesh=a;this._currIndex=0}})};DDLS.FromMeshToFaces.prototype={next:function(){do if(this._currIndex<this._fromMesh._faces.length)this._resultFace=this._fromMesh._faces[this._currIndex],this._currIndex++;else{this._resultFace=null;break}while(!this._resultFace.isReal);return this._resultFace}};
DDLS.FromVertexToHoldingFaces=function(){Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.edge}})};
DDLS.FromVertexToHoldingFaces.prototype={next:function(){if(null!=this._nextEdge){do if(this._resultFace=this._nextEdge.leftFace,this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;this._resultFace.isReal||(this._resultFace=null);break}while(!this._resultFace.isReal)}else this._resultFace=null;return this._resultFace}};
DDLS.FromVertexToIncomingEdges=function(){Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;for(this._nextEdge=this._fromVertex.edge;!this._nextEdge.isReal;)this._nextEdge=this._nextEdge.rotLeftEdge}})};
DDLS.FromVertexToIncomingEdges.prototype={next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge.oppositeEdge;do if(this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;break}while(!this._nextEdge.isReal)}else this._resultEdge=null;return this._resultEdge}};
DDLS.FromVertexToOutgoingEdges=function(){this.realEdgesOnly=!0;Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.edge;if(null!=this._nextEdge)for(;this.realEdgesOnly&&!this._nextEdge.isReal;)this._nextEdge=this._nextEdge.rotLeftEdge}})};
DDLS.FromVertexToOutgoingEdges.prototype={next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge;do if(this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;break}while(this.realEdgesOnly&&!this._nextEdge.isReal)}else this._resultEdge=null;return this._resultEdge}};DDLS.FromVertexToNeighbourVertices=function(){Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.edge}})};
DDLS.FromVertexToNeighbourVertices.prototype={next:function(){if(null!=this._nextEdge){this._resultVertex=this._nextEdge.destinationVertex;do this._nextEdge=this._nextEdge.rotLeftEdge;while(!this._nextEdge.isReal);this._nextEdge==this._fromVertex.edge&&(this._nextEdge=null)}else this._resultVertex=null;return this._resultVertex}};DDLS.Geom2D={};DDLS.Geom2D.__samples=[];DDLS.Geom2D.__circumcenter=new DDLS.Point;
DDLS.Geom2D.locatePosition=function(a,b,c){null==DDLS.Geom2D._randGen&&(DDLS.Geom2D._randGen=new DDLS.RandGenerator);DDLS.Geom2D._randGen.seed=10*a+4*b|0;DDLS.Geom2D.__samples.splice(0,DDLS.Geom2D.__samples.length);var d=DDLS.int(DDLS.pow(c._vertices.length,0.3333333333333333));DDLS.Geom2D._randGen.rangeMin=0;DDLS.Geom2D._randGen.rangeMax=c._vertices.length-1;for(var e=0,f;e<d;)e++,f=DDLS.Geom2D._randGen.next(),DDLS.Debug.assertFalse(0>f||f>c._vertices.length-1,"_rnd: "+f,{fileName:"Geom2D.hx",lineNumber:67,
className:"DDLS.Geom2D",methodName:"locatePosition"}),DDLS.Debug.assertFalse(null==c._vertices,"vertices: "+c._vertices.length,{fileName:"Geom2D.hx",lineNumber:68,className:"DDLS.Geom2D",methodName:"locatePosition"}),DDLS.Geom2D.__samples.push(c._vertices[f]);var n,g,e=DDLS.POSITIVE_INFINITY;c=null;for(f=0;f<d;)n=f++,n=DDLS.Geom2D.__samples[n],g=n.pos,g=(g.x-a)*(g.x-a)+(g.y-b)*(g.y-b),g<e&&(e=g,c=n);d=new DDLS.FromVertexToHoldingFaces;d.fromVertex=c;n=d.next();d=new DDLS.Dictionary;c=new DDLS.FromFaceToInnerEdges;
e=DDLS.Intersection.ENull;for(f=0;d.get(n)||3==(e=DDLS.Geom2D.isInFace(a,b,n))[1];){f++;50==f&&DDLS.Log("WALK TAKE MORE THAN 50 LOOP");c.fromFace=n;do{n=c.next();if(null==n)return DDLS.Log("KILL PATH"),DDLS.Intersection.ENull;g=DDLS.Geom2D.getRelativePosition(a,b,n)}while(1==g||0==g);n=n.rightFace}return e};
DDLS.Geom2D.isCircleIntersectingAnyConstraint=function(a,b,c,d){if(0>=a||a>=d.width||0>=b||b>=d.height)return!0;d=DDLS.Geom2D.locatePosition(a,b,d);var e;switch(d[1]){case 0:e=d[2].edge.leftFace;break;case 1:e=d[2].leftFace;break;case 2:e=d[2];break;case 3:e=null}d=c*c;var f;f=e.edge.originVertex.pos;f=(f.x-a)*(f.x-a)+(f.y-b)*(f.y-b);if(f<=d)return!0;f=e.edge.nextLeftEdge.originVertex.pos;f=(f.x-a)*(f.x-a)+(f.y-b)*(f.y-b);if(f<=d)return!0;f=e.edge.nextLeftEdge.nextLeftEdge.originVertex.pos;f=(f.x-
a)*(f.x-a)+(f.y-b)*(f.y-b);if(f<=d)return!0;d=[];d.push(e.edge);d.push(e.edge.nextLeftEdge);d.push(e.edge.nextLeftEdge.nextLeftEdge);var n,g;for(f=new DDLS.Dictionary;0<d.length;)if(e=d.pop(),f.set(e,!0),n=e.originVertex.pos,g=e.destinationVertex.pos,n=DDLS.Geom2D.intersectionsSegmentCircle(n.x,n.y,g.x,g.y,a,b,c)){if(e.isConstrained)return!0;e=e.oppositeEdge.nextLeftEdge;f.get(e)||f.get(e.oppositeEdge)||-1!=d.indexOf(e)||-1!=d.indexOf(e.oppositeEdge)||d.push(e);e=e.nextLeftEdge;f.get(e)||f.get(e.oppositeEdge)||
-1!=d.indexOf(e)||-1!=d.indexOf(e.oppositeEdge)||d.push(e)}return!1};DDLS.Geom2D.getDirection=function(a,b,c,d,e,f){a=(e-a)*(d-b)+(f-b)*(-c+a);return 0==a?0:0<a?1:-1};DDLS.Geom2D.getDirection2=function(a,b,c,d,e,f){var n=(e-a)*(d-b)+(f-b)*(-c+a);return 0==n?0:0<n?1E-4>=DDLS.Geom2D.distanceSquaredPointToLine(e,f,a,b,c,d)?0:1:1E-4>=DDLS.Geom2D.distanceSquaredPointToLine(e,f,a,b,c,d)?0:-1};
DDLS.Geom2D.getRelativePosition=function(a,b,c){return DDLS.Geom2D.getDirection(c.originVertex.pos.x,c.originVertex.pos.y,c.destinationVertex.pos.x,c.destinationVertex.pos.y,a,b)};DDLS.Geom2D.getRelativePosition2=function(a,b,c){return DDLS.Geom2D.getDirection2(c.originVertex.pos.x,c.originVertex.pos.y,c.destinationVertex.pos.x,c.destinationVertex.pos.y,a,b)};
DDLS.Geom2D.isInFace=function(a,b,c){var d=DDLS.Intersection.ENull,e=c.edge,f=e.nextLeftEdge,n=f.nextLeftEdge;if(0<=DDLS.Geom2D.getRelativePosition(a,b,e)&&0<=DDLS.Geom2D.getRelativePosition(a,b,f)&&0<=DDLS.Geom2D.getRelativePosition(a,b,n))var d=e.originVertex,g=f.originVertex,k=n.originVertex,m=d.pos.x,l=d.pos.y,h=g.pos.x,p=g.pos.y,r=k.pos.x,q=k.pos.y,s=(a-m)*(h-m)+(b-l)*(p-l),t=(a-h)*(r-h)+(b-p)*(q-p),v=(a-r)*(m-r)+(b-q)*(l-q),t=1E-4>=(h-a)*(h-a)+(p-b)*(p-b)-t*t/((r-h)*(r-h)+(q-p)*(q-p)),r=1E-4>=
(r-a)*(r-a)+(q-b)*(q-b)-v*v/((m-r)*(m-r)+(l-q)*(l-q)),d=1E-4>=(m-a)*(m-a)+(l-b)*(l-b)-s*s/((h-m)*(h-m)+(p-l)*(p-l))?r?DDLS.Intersection.EVertex(d):t?DDLS.Intersection.EVertex(g):DDLS.Intersection.EEdge(e):t?r?DDLS.Intersection.EVertex(k):DDLS.Intersection.EEdge(f):r?DDLS.Intersection.EEdge(n):DDLS.Intersection.EFace(c);return d};
DDLS.Geom2D.clipSegmentByTriangle=function(a,b,c,d,e,f,n,g,k,m,l,h){var p,r;p=DDLS.Geom2D.getDirection(e,f,n,g,a,b);r=DDLS.Geom2D.getDirection(e,f,n,g,c,d);if(0>=p&&0>=r)return!1;var q,s;q=DDLS.Geom2D.getDirection(n,g,k,m,a,b);s=DDLS.Geom2D.getDirection(n,g,k,m,c,d);if(0>=q&&0>=s)return!1;var t,v;t=DDLS.Geom2D.getDirection(k,m,e,f,a,b);v=DDLS.Geom2D.getDirection(k,m,e,f,c,d);if(0>=t&&0>=v)return!1;if(0<=p&&0<=q&&0<=t&&0<=r&&0<=s&&0<=v)return l.x=a,l.y=b,h.x=c,h.y=d,!0;var u=0;DDLS.Geom2D.intersections2segments(a,
b,c,d,e,f,n,g,l,null)&&u++;0==u?DDLS.Geom2D.intersections2segments(a,b,c,d,n,g,k,m,l,null)&&u++:DDLS.Geom2D.intersections2segments(a,b,c,d,n,g,k,m,h,null)&&(-0.01>l.x-h.x||0.01<l.x-h.x||-0.01>l.y-h.y||0.01<l.y-h.y)&&u++;0==u?DDLS.Geom2D.intersections2segments(a,b,c,d,k,m,e,f,l,null)&&u++:1==u&&DDLS.Geom2D.intersections2segments(a,b,c,d,k,m,e,f,h,null)&&(-0.01>l.x-h.x||0.01<l.x-h.x||-0.01>l.y-h.y||0.01<l.y-h.y)&&u++;1==u&&(0<=p&&0<=q&&0<=t?(h.x=a,h.y=b):0<=r&&0<=s&&0<=v?(h.x=c,h.y=d):u=0);return 0<
u?!0:!1};
DDLS.Geom2D.isSegmentIntersectingTriangle=function(a,b,c,d,e,f,n,g,k,m){var l,h;l=DDLS.Geom2D.getDirection(e,f,n,g,a,b);h=DDLS.Geom2D.getDirection(e,f,n,g,c,d);if(0>=l&&0>=h)return!1;var p,r;p=DDLS.Geom2D.getDirection(n,g,k,m,a,b);r=DDLS.Geom2D.getDirection(n,g,k,m,c,d);if(0>=p&&0>=r)return!1;var q,s;q=DDLS.Geom2D.getDirection(k,m,e,f,a,b);s=DDLS.Geom2D.getDirection(k,m,e,f,c,d);if(0>=q&&0>=s)return!1;if(1==l&&1==p&&1==q||1==l&&1==p&&1==q)return!0;if(1==l&&0>=h||0>=l&&1==h)if(l=DDLS.Geom2D.getDirection(a,b,
c,d,e,f),h=DDLS.Geom2D.getDirection(a,b,c,d,n,g),1==l&&0>=h||0>=l&&1==h)return!0;if(1==p&&0>=r||0>=p&&1==r)if(l=DDLS.Geom2D.getDirection(a,b,c,d,n,g),h=DDLS.Geom2D.getDirection(a,b,c,d,k,m),1==l&&0>=h||0>=l&&1==h)return!0;if(1==q&&0>=s||0>=q&&1==s)if(l=DDLS.Geom2D.getDirection(a,b,c,d,k,m),h=DDLS.Geom2D.getDirection(a,b,c,d,e,f),1==l&&0>=h||0>=l&&1==h)return!0;return!1};
DDLS.Geom2D.isDelaunay=function(a){var b=a.originVertex,c=a.destinationVertex,d=a.nextLeftEdge.destinationVertex;a=a.nextRightEdge.destinationVertex;DDLS.Geom2D.getCircumcenter(d.pos.x,d.pos.y,b.pos.x,b.pos.y,c.pos.x,c.pos.y,DDLS.Geom2D.__circumcenter);return(a.pos.x-DDLS.Geom2D.__circumcenter.x)*(a.pos.x-DDLS.Geom2D.__circumcenter.x)+(a.pos.y-DDLS.Geom2D.__circumcenter.y)*(a.pos.y-DDLS.Geom2D.__circumcenter.y)>=(d.pos.x-DDLS.Geom2D.__circumcenter.x)*(d.pos.x-DDLS.Geom2D.__circumcenter.x)+(d.pos.y-
DDLS.Geom2D.__circumcenter.y)*(d.pos.y-DDLS.Geom2D.__circumcenter.y)};DDLS.Geom2D.getCircumcenter=function(a,b,c,d,e,f,n){null==n&&(n=new DDLS.Point);var g=0.5*(a+c),k=0.5*(b+d);e=(g*(a-e)+(k-0.5*(b+f))*(b-f)+0.5*(a+e)*(e-a))/(a*(f-d)+c*(b-f)+e*(d-b));n.x=g+e*(d-b);n.y=k-e*(c-a);return n};
DDLS.Geom2D.intersections2segments=function(a,b,c,d,e,f,n,g,k,m,l){null==l&&(l=!1);var h=0,p=0,r,q=(a-c)*(f-g)+(d-b)*(e-n);0==q?r=!1:(r=!0,q=1/q,l&&null==k&&null==m||(h=(a*(f-g)+b*(n-e)+e*g-f*n)*q,p=(a*(f-d)+b*(c-e)-c*f+d*e)*q,l||0<=h&&1>=h&&0<=p&&1>=p||(r=!1)));r&&(null!=k&&(k.x=a+h*(c-a),k.y=b+h*(d-b)),null!=m&&(m.push(h),m.push(p)));return r};
DDLS.Geom2D.intersections2edges=function(a,b,c,d,e){null==e&&(e=!1);return DDLS.Geom2D.intersections2segments(a.originVertex.pos.x,a.originVertex.pos.y,a.destinationVertex.pos.x,a.destinationVertex.pos.y,b.originVertex.pos.x,b.originVertex.pos.y,b.destinationVertex.pos.x,b.destinationVertex.pos.y,c,d,e)};
DDLS.Geom2D.isConvex=function(a){var b=!0,c,d;c=a.nextLeftEdge.oppositeEdge;d=a.nextRightEdge.destinationVertex;-1!=DDLS.Geom2D.getRelativePosition(d.pos.x,d.pos.y,c)?b=!1:(c=a.prevRightEdge,d=a.prevLeftEdge.originVertex,-1!=DDLS.Geom2D.getRelativePosition(d.pos.x,d.pos.y,c)&&(b=!1));return b};
DDLS.Geom2D.projectOrthogonaly=function(a,b){var c=b.originVertex.pos.x,d=b.originVertex.pos.y,e=b.destinationVertex.pos.x,f=b.destinationVertex.pos.y,n=a.x,g=a.y,n=(c*c-c*e-c*n+d*d-d*f-d*g+e*n+f*g)/(c*c-2*c*e+d*d-2*d*f+e*e+f*f);a.x=c+n*(e-c);a.y=d+n*(f-d)};DDLS.Geom2D.projectOrthogonalyOnSegment=function(a,b,c,d,e,f,n){a=(c*c-c*e-c*a+d*d-d*f-d*b+e*a+f*b)/(c*c-2*c*e+d*d-2*d*f+e*e+f*f);n.x=c+a*(e-c);n.y=d+a*(f-d)};
DDLS.Geom2D.intersections2Circles=function(a,b,c,d,e,f,n){var g=(d-a)*(d-a)+(e-b)*(e-b),k=1/(2*g);if((a!=d||b!=e)&&g<=(c+f)*(c+f)&&g>=(c-f)*(c-f)){var g=DDLS.sqrt(((c+f)*(c+f)-g)*(g-(f-c)*(f-c))),m=0.5*(a+d)+(d-a)*(c*c-f*f)*k;c=0.5*(b+e)+(e-b)*(c*c-f*f)*k;b=(e-b)*k;d=(d-a)*k;if(null!=n)for(a=0,g=[m+b*g,c-d*g,m-b*g,c+d*g];a<g.length;)m=g[a],++a,n.push(m);return!0}return!1};
DDLS.Geom2D.intersectionsSegmentCircle=function(a,b,c,d,e,f,n,g){var k=a*a,m=b*b,l=d*d-2*d*b+m+c*c-2*c*a+k,h=2*b*f-2*k+2*d*b-2*m+2*c*a-2*c*e+2*a*e-2*d*f;e=h*h-4*l*(m+f*f+e*e-2*b*f-2*a*e+k-n*n);if(0>e)return!1;if(0==e){e=-h/(2*l);if(0>e||1<e)return!1;if(null!=g)for(l=0,a=[a+e*(c-a),b+e*(d-b),e];l<a.length;)b=a[l],++l,g.push(b);return!0}f=DDLS.sqrt(e);e=(-h+f)/(2*l);l=(-h-f)/(2*l);h=!1;if(0<=e&&1>=e){if(null!=g)for(h=0,e=[a+e*(c-a),b+e*(d-b),e];h<e.length;)f=e[h],++h,g.push(f);h=!0}if(0<=l&&1>=l){if(null!=
g)for(h=0,a=[a+l*(c-a),b+l*(d-b),l];h<a.length;)b=a[h],++h,g.push(b);h=!0}return h};
DDLS.Geom2D.intersectionsLineCircle=function(a,b,c,d,e,f,n,g){var k=a*a,m=b*b,l=d*d-2*d*b+m+c*c-2*c*a+k,h=2*b*f-2*k+2*d*b-2*m+2*c*a-2*c*e+2*a*e-2*d*f;e=h*h-4*l*(m+f*f+e*e-2*b*f-2*a*e+k-n*n);if(0>e)return!1;if(0==e)for(e=-h/(2*l),l=0,a=[a+e*(c-a),b+e*(d-b),e];l<a.length;)b=a[l],++l,g.push(b);else if(0<e)for(f=DDLS.sqrt(e),e=(-h+f)/(2*l),h=(-h-f)/(2*l),l=0,a=[a+e*(c-a),b+e*(d-b),e,a+h*(c-a),b+h*(d-b),h];l<a.length;)b=a[l],++l,g.push(b);return!0};
DDLS.Geom2D.tangentsPointToCircle=function(a,b,c,d,e,f){var n=0.5*(a+c),g=0.5*(b+d);a=0.5*DDLS.sqrt((a-c)*(a-c)+(b-d)*(b-d));return DDLS.Geom2D.intersections2Circles(n,g,a,c,d,e,f)};
DDLS.Geom2D.tangentsCrossCircleToCircle=function(a,b,c,d,e,f){var n=DDLS.sqrt((b-d)*(b-d)+(c-e)*(c-e));if(DDLS.Geom2D.intersections2Circles(b,c,a,b+0.25*(d-b),c+0.25*(e-c),0.25*n,f)){a=f[0];var g=f[1],k=0.5*(b+d),m=0.5*(c+e),n=((a-k)*(e-c)+(g-m)*(-d+b))/(n*n);c=2*(k+n*(e-c))-a;d=2*(m-n*(d-b))-g;b=0;for(a=[c+f[2]-a,f[3]+d-g,c,d];b<a.length;)g=a[b],++b,f.push(g);return!0}return!1};
DDLS.Geom2D.tangentsParalCircleToCircle=function(a,b,c,d,e,f){var n=1/DDLS.sqrt((b-d)*(b-d)+(c-e)*(c-e)),g=b+a*(e-c)*n,n=c+a*(-d+b)*n,k=2*b-g,m=2*c-n;a=0;for(b=[g,n,k,m,k+d-b,m+e-c,g+d-b,n+e-c];a<b.length;)c=b[a],++a,f.push(c)};DDLS.Geom2D.distanceSquaredPointToLine=function(a,b,c,d,e,f){var n=(a-c)*(e-c)+(b-d)*(f-d);return(c-a)*(c-a)+(d-b)*(d-b)-n*n/((e-c)*(e-c)+(f-d)*(f-d))};
DDLS.Geom2D.distanceSquaredPointToSegment=function(a,b,c,d,e,f){var n=(e-c)*(e-c)+(f-d)*(f-d),g=((a-c)*(e-c)+(b-d)*(f-d))/n;return 0>g?(a-c)*(a-c)+(b-d)*(b-d):1>=g?(c-a)*(c-a)+(d-b)*(d-b)-g*g*n:(a-e)*(a-e)+(b-f)*(b-f)};DDLS.Geom2D.distanceSquaredVertexToEdge=function(a,b){return DDLS.Geom2D.distanceSquaredPointToSegment(a.pos.x,a.pos.y,b.originVertex.pos.x,b.originVertex.pos.y,b.destinationVertex.pos.x,b.destinationVertex.pos.y)};
DDLS.Geom2D.pathLength=function(a){for(var b=0,c=a[0],d=a[1],e,f,n=2;n<a.length;)e=a[n],f=a[n+1],c=e-c,d=f-d,d=DDLS.sqrt(c*c+d*d),b+=d,c=e,d=f,n+=2;return b};DDLS.Mesh=function(a,b){this.id=DDLS.MeshID;DDLS.MeshID++;this.__objectsUpdateInProgress=!1;this.__centerVertex=null;this.width=a;this.height=b;this.clipping=!0;this._edges=[];this._faces=[];this._objects=[];this._vertices=[];this.__edgesToCheck=[];this._constraintShapes=[]};
DDLS.Mesh.prototype={constructor:DDLS.Mesh,dispose:function(){for(;0<this._vertices.length;)this._vertices.pop().dispose();for(this._vertices=null;0<this._edges.length;)this._edges.pop().dispose();for(this._edges=null;0<this._faces.length;)this._faces.pop().dispose();for(this._faces=null;0<this._constraintShapes.length;)this._constraintShapes.pop().dispose();for(this._constraintShapes=null;0<this._objects.length;)this._objects.pop().dispose();this.__centerVertex=this.__edgesToCheck=this._objects=
null},get___constraintShapes:function(){return this._constraintShapes},buildFromRecord:function(a){a=a.split(";");for(var b=0;b<a.length;)this.insertConstraintSegment(parseFloat(a[b]),parseFloat(a[b+1]),parseFloat(a[b+2]),parseFloat(a[b+3])),b+=4},insertObject:function(a){null!=a.constraintShape&&this.deleteObject(a);var b=new DDLS.Shape,c,d=a.coordinates,e=a.matrix;a.updateMatrixFromValues();for(var f,n,g,k=0;k<d.length;)c=d[k],f=d[k+1],n=d[k+2],g=d[k+3],c=this.insertConstraintSegment(e.transformX(c,
f),e.transformY(c,f),e.transformX(n,g),e.transformY(n,g)),null!=c&&(c.fromShape=b,b.segments.push(c)),k+=4;this._constraintShapes.push(b);a.constraintShape=b;this.__objectsUpdateInProgress||this._objects.push(a)},deleteObject:function(a){null!=a.constraintShape&&(this.deleteConstraintShape(a.constraintShape),a.constraintShape=null,this.__objectsUpdateInProgress||(a=this._objects.indexOf(a),this._objects.splice(a,1)))},updateObjects:function(){this.__objectsUpdateInProgress=!0;for(var a=0,b=this._objects.length;a<
b;){var c=a++;this._objects[c].hasChanged&&(this.deleteObject(this._objects[c]),this.insertObject(this._objects[c]),this._objects[c].hasChanged=!1)}this.__objectsUpdateInProgress=!1},insertConstraintShape:function(a){for(var b=new DDLS.Shape,c=null,d=0;d<a.length;)c=this.insertConstraintSegment(a[d],a[d+1],a[d+2],a[d+3]),null!=c&&(c.fromShape=b,b.segments.push(c)),d+=4;this._constraintShapes.push(b);return b},deleteConstraintShape:function(a){for(var b=0,c=a.segments.length;b<c;){var d=b++;this.deleteConstraintSegment(a.segments[d])}a.dispose();
this._constraintShapes.splice(this._constraintShapes.indexOf(a),1)},insertConstraintSegment:function(a,b,c,d){var e=a,f=b,n=c,g=d;if(a>this.width&&c>this.width||0>a&&0>c||b>this.height&&d>this.height||0>b&&0>d)return null;c-=a;d-=b;var k=DDLS.NEGATIVE_INFINITY,m=DDLS.POSITIVE_INFINITY;if(0!=c)var l=(0-a)/c,h=(this.width-a)/c,k=DDLS.max(k,DDLS.min(l,h)),m=DDLS.min(m,DDLS.max(l,h));0!=d&&(l=(0-b)/d,h=(this.height-b)/d,k=DDLS.max(k,DDLS.min(l,h)),m=DDLS.min(m,DDLS.max(l,h)));if(m>=k)1>m&&(n=c*m+a,g=
d*m+b),0<k&&(e=c*k+a,f=d*k+b);else return null;a=this.insertVertex(e,f);if(null==a)return null;n=this.insertVertex(n,g);if(null==n||a===n)return null;g=new DDLS.FromVertexToOutgoingEdges;b=new DDLS.Segment;e=new DDLS.Edge;f=new DDLS.Edge;e.setDatas(a,f,null,null,!0,!0);f.setDatas(n,e,null,null,!0,!0);f=[];c=[];d=[];for(var h={},k=new DDLS.Point,p=!1,h=DDLS.Intersection.EVertex(a);;)switch(p=!1,h[1]){case 0:m=h[2];for(g.fromVertex=m;null!=(l=g.next());){if(l.destinationVertex==n)return l.isConstrained||
(l.isConstrained=!0,l.oppositeEdge.isConstrained=!0),l.addFromConstraintSegment(b),l.oppositeEdge.fromConstraintSegments=l.fromConstraintSegments,a.addFromConstraintSegment(b),n.addFromConstraintSegment(b),b.addEdge(l),b;if(1E-4>=DDLS.Geom2D.distanceSquaredVertexToEdge(l.destinationVertex,e)){l.isConstrained||(l.isConstrained=!0,l.oppositeEdge.isConstrained=!0);l.addFromConstraintSegment(b);l.oppositeEdge.fromConstraintSegments=l.fromConstraintSegments;a.addFromConstraintSegment(b);b.addEdge(l);a=
l.destinationVertex;e.originVertex=a;h=DDLS.Intersection.EVertex(a);p=!0;break}}if(p)continue;for(g.fromVertex=m;null!=(l=g.next());)if(l=l.nextLeftEdge,DDLS.Geom2D.intersections2edges(l,e,k)){if(l.isConstrained){a=this.splitEdge(l,k.x,k.y);for(g.fromVertex=m;null!=(l=g.next());)if(l.destinationVertex==a){l.isConstrained=!0;l.oppositeEdge.isConstrained=!0;l.addFromConstraintSegment(b);l.oppositeEdge.fromConstraintSegments=l.fromConstraintSegments;b.addEdge(l);break}m.addFromConstraintSegment(b);e.originVertex=
a;h=DDLS.Intersection.EVertex(a)}else f.push(l),c.unshift(l.nextLeftEdge),d.push(l.prevLeftEdge),l=l.oppositeEdge,h=DDLS.Intersection.EEdge(l);break}break;case 1:l=h[2];m=l.nextLeftEdge;if(m.destinationVertex==n)return c.unshift(m.nextLeftEdge),d.push(m),l=new DDLS.Edge,h=new DDLS.Edge,l.setDatas(a,h,null,null,!0,!0),h.setDatas(n,l,null,null,!0,!0),c.push(l),d.push(h),this.insertNewConstrainedEdge(b,l,f,c,d),b;if(1E-4>=DDLS.Geom2D.distanceSquaredVertexToEdge(m.destinationVertex,e))c.unshift(m.nextLeftEdge),
d.push(m),l=new DDLS.Edge,h=new DDLS.Edge,l.setDatas(a,h,null,null,!0,!0),h.setDatas(m.destinationVertex,l,null,null,!0,!0),c.push(l),d.push(h),this.insertNewConstrainedEdge(b,l,f,c,d),f.splice(0,f.length),c.splice(0,c.length),d.splice(0,d.length),a=m.destinationVertex,e.originVertex=a,h=DDLS.Intersection.EVertex(a);else if(DDLS.Geom2D.intersections2edges(m,e,k))if(m.isConstrained){m=this.splitEdge(m,k.x,k.y);for(g.fromVertex=m;null!=(l=g.next());)l.destinationVertex===c[0].originVertex&&c.unshift(l),
l.destinationVertex===d[d.length-1].destinationVertex&&d.push(l.oppositeEdge);l=new DDLS.Edge;h=new DDLS.Edge;l.setDatas(a,h,null,null,!0,!0);h.setDatas(m,l,null,null,!0,!0);c.push(l);d.push(h);this.insertNewConstrainedEdge(b,l,f,c,d);f.splice(0,f.length);c.splice(0,c.length);d.splice(0,d.length);a=m;e.originVertex=a;h=DDLS.Intersection.EVertex(a)}else f.push(m),c.unshift(m.nextLeftEdge),l=m.oppositeEdge,h=DDLS.Intersection.EEdge(l);else if(m=m.nextLeftEdge,DDLS.Geom2D.intersections2edges(m,e,k),
m.isConstrained){m=this.splitEdge(m,k.x,k.y);for(g.fromVertex=m;null!=(l=g.next());)l.destinationVertex==c[0].originVertex&&c.unshift(l),l.destinationVertex==d[d.length-1].destinationVertex&&d.push(l.oppositeEdge);l=new DDLS.Edge;h=new DDLS.Edge;l.setDatas(a,h,null,null,!0,!0);h.setDatas(m,l,null,null,!0,!0);c.push(l);d.push(h);this.insertNewConstrainedEdge(b,l,f,c,d);f.splice(0,f.length);c.splice(0,c.length);d.splice(0,d.length);a=m;e.originVertex=a;h=DDLS.Intersection.EVertex(a)}else f.push(m),
d.push(m.prevLeftEdge),l=m.oppositeEdge,h=DDLS.Intersection.EEdge(l)}},insertNewConstrainedEdge:function(a,b,c,d,e){this._edges.push(b);this._edges.push(b.oppositeEdge);b.addFromConstraintSegment(a);b.oppositeEdge.fromConstraintSegments=b.fromConstraintSegments;a.addEdge(b);b.originVertex.addFromConstraintSegment(a);b.destinationVertex.addFromConstraintSegment(a);this.untriangulate(c);this.triangulate(d,!0);this.triangulate(e,!0)},deleteConstraintSegment:function(a){for(var b=[],c=null,d,e=0,f=a.edges.length;e<
f;)c=e++,c=a.edges[c],c.removeFromConstraintSegment(a),0==c.fromConstraintSegments.length&&(c.isConstrained=!1,c.oppositeEdge.isConstrained=!1),d=c.originVertex,d.removeFromConstraintSegment(a),b.push(d);d=c.destinationVertex;d.removeFromConstraintSegment(a);b.push(d);e=0;for(f=b.length;e<f;)c=e++,this.deleteVertex(b[c]);a.dispose()},check:function(){for(var a=0,b=this._edges.length;a<b;){var c=a++;if(null==this._edges[c].nextLeftEdge){DDLS.Log("!!! missing nextLeftEdge");return}}DDLS.Log("check OK")},
insertVertex:function(a,b){if(0>a||0>b||a>this.width||b>this.height)return null;this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var c=DDLS.Geom2D.locatePosition(a,b,this),d=null;switch(c[1]){case 0:d=c[2];break;case 1:d=this.splitEdge(c[2],a,b);break;case 2:d=this.splitFace(c[2],a,b)}this.restoreAsDelaunay();return d},flipEdge:function(a){var b=a.oppositeEdge,c=new DDLS.Edge,d=new DDLS.Edge,e=a.nextLeftEdge,f=e.nextLeftEdge,n=b.nextLeftEdge,g=n.nextLeftEdge,k=a.originVertex,m=b.originVertex,
l=f.originVertex,h=g.originVertex,p=a.leftFace,r=b.leftFace,q=new DDLS.Face,s=new DDLS.Face;this._edges.push(c);this._edges.push(d);this._faces.push(s);this._faces.push(q);c.setDatas(l,d,g,s,a.isReal,a.isConstrained);d.setDatas(h,c,f,q,a.isReal,a.isConstrained);s.setDatas(c);q.setDatas(d);m.edge===b&&m.setDatas(e);k.edge===a&&k.setDatas(n);e.nextLeftEdge=c;e.leftFace=s;f.nextLeftEdge=n;f.leftFace=q;n.nextLeftEdge=d;n.leftFace=q;g.nextLeftEdge=e;g.leftFace=s;a.dispose();b.dispose();this._edges.splice(this._edges.indexOf(a),
1);this._edges.splice(this._edges.indexOf(b),1);p.dispose();r.dispose();this._faces.splice(this._faces.indexOf(p),1);this._faces.splice(this._faces.indexOf(r),1);return d},splitEdge:function(a,b,c){this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var d=a.oppositeEdge,e=a.nextLeftEdge,f=e.nextLeftEdge,n=d.nextLeftEdge,g=n.nextLeftEdge,k=f.originVertex,m=a.originVertex,l=g.originVertex,h=d.originVertex,p=a.leftFace,r=d.leftFace;if((m.pos.x-b)*(m.pos.x-b)+(m.pos.y-c)*(m.pos.y-c)<=DDLS.EPSILON_SQUARED)return m;
if((h.pos.x-b)*(h.pos.x-b)+(h.pos.y-c)*(h.pos.y-c)<=DDLS.EPSILON_SQUARED)return h;var q=new DDLS.Vertex,s=new DDLS.Edge,t=new DDLS.Edge,v=new DDLS.Edge,u=new DDLS.Edge,w=new DDLS.Edge,y=new DDLS.Edge,z=new DDLS.Edge,x=new DDLS.Edge,A=new DDLS.Face,B=new DDLS.Face,C=new DDLS.Face,D=new DDLS.Face;this._vertices.push(q);this._edges.push(t);this._edges.push(s);this._edges.push(y);this._edges.push(w);this._edges.push(u);this._edges.push(v);this._edges.push(x);this._edges.push(z);this._faces.push(D);this._faces.push(C);
this._faces.push(B);this._faces.push(A);q.setDatas(p.isReal?t:u);q.pos.x=b;q.pos.y=c;DDLS.Geom2D.projectOrthogonaly(q.pos,a);t.setDatas(q,s,f,A,p.isReal);s.setDatas(k,t,x,D,p.isReal);y.setDatas(q,w,n,B,a.isReal,a.isConstrained);w.setDatas(m,y,t,A,a.isReal,a.isConstrained);u.setDatas(q,v,g,C,r.isReal);v.setDatas(l,u,y,B,r.isReal);x.setDatas(q,z,e,D,a.isReal,a.isConstrained);z.setDatas(h,x,u,C,a.isReal,a.isConstrained);A.setDatas(t,p.isReal);B.setDatas(y,r.isReal);C.setDatas(u,r.isReal);D.setDatas(x,
p.isReal);m.edge===a&&m.setDatas(w);h.edge===d&&h.setDatas(z);f.nextLeftEdge=w;f.leftFace=A;n.nextLeftEdge=v;n.leftFace=B;g.nextLeftEdge=z;g.leftFace=C;e.nextLeftEdge=s;e.leftFace=D;if(a.isConstrained){b=a.fromConstraintSegments;w.fromConstraintSegments=b.slice(0);y.fromConstraintSegments=w.fromConstraintSegments;x.fromConstraintSegments=b.slice(0);z.fromConstraintSegments=x.fromConstraintSegments;c=0;for(k=a.fromConstraintSegments.length;c<k;)m=c++,m=a.fromConstraintSegments[m].edges,l=m.indexOf(a),
-1!=l?m.splice(l,1,w,x):m.splice(m.indexOf(d),1,z,y);q.fromConstraintSegments=b.slice(0)}a.dispose();d.dispose();this._edges.splice(this._edges.indexOf(a),1);this._edges.splice(this._edges.indexOf(d),1);p.dispose();r.dispose();this._faces.splice(this._faces.indexOf(p),1);this._faces.splice(this._faces.indexOf(r),1);this.__centerVertex=q;this.__edgesToCheck.push(f);this.__edgesToCheck.push(n);this.__edgesToCheck.push(g);this.__edgesToCheck.push(e);return q},splitFace:function(a,b,c){this.__edgesToCheck.splice(0,
this.__edgesToCheck.length);var d=a.edge,e=d.nextLeftEdge,f=e.nextLeftEdge,n=d.originVertex,g=e.originVertex,k=f.originVertex,m=new DDLS.Vertex,l=new DDLS.Edge,h=new DDLS.Edge,p=new DDLS.Edge,r=new DDLS.Edge,q=new DDLS.Edge,s=new DDLS.Edge,t=new DDLS.Face,v=new DDLS.Face,u=new DDLS.Face;this._vertices.push(m);this._edges.push(l);this._edges.push(h);this._edges.push(p);this._edges.push(r);this._edges.push(q);this._edges.push(s);this._faces.push(t);this._faces.push(v);this._faces.push(u);m.setDatas(h);
m.pos.x=b;m.pos.y=c;l.setDatas(n,h,s,u);h.setDatas(m,l,d,t);p.setDatas(g,r,h,t);r.setDatas(m,p,e,v);q.setDatas(k,s,r,v);s.setDatas(m,q,f,u);t.setDatas(h);v.setDatas(r);u.setDatas(s);d.nextLeftEdge=p;d.leftFace=t;e.nextLeftEdge=q;e.leftFace=v;f.nextLeftEdge=l;f.leftFace=u;a.dispose();this._faces.splice(this._faces.indexOf(a),1);this.__centerVertex=m;this.__edgesToCheck.push(d);this.__edgesToCheck.push(e);this.__edgesToCheck.push(f);return m},restoreAsDelaunay:function(){for(var a;0<this.__edgesToCheck.length;)a=
this.__edgesToCheck.shift(),!a.isReal||a.isConstrained||DDLS.Geom2D.isDelaunay(a)||(a.nextLeftEdge.destinationVertex==this.__centerVertex?(this.__edgesToCheck.push(a.nextRightEdge),this.__edgesToCheck.push(a.prevRightEdge)):(this.__edgesToCheck.push(a.nextLeftEdge),this.__edgesToCheck.push(a.prevLeftEdge)),this.flipEdge(a))},deleteVertex:function(a){var b,c=new DDLS.FromVertexToOutgoingEdges;c.fromVertex=a;c.realEdgesOnly=!1;var d,e=[];b=0==a.fromConstraintSegments.length;var f=[],n=!1,g=!1,k=[],
m=[];if(b)for(;null!=(d=c.next());)e.push(d),f.push(d.nextLeftEdge);else{k=0;for(m=a.fromConstraintSegments.length;k<m;)if(n=k++,d=a.fromConstraintSegments[n].edges,d[0].originVertex==a||d[d.length-1].destinationVertex==a)return!1;for(k=0;null!=(d=c.next());)if(e.push(d),d.isConstrained&&(k++,2<k))return!1;var k=[],m=[],l=c=null,h=new DDLS.Edge,p=new DDLS.Edge;this._edges.push(h);this._edges.push(p);n=0;for(g=e.length;n<g;)d=n++,d=e[d],d.isConstrained?null==c?(p.setDatas(d.destinationVertex,h,null,
null,!0,!0),k.push(h),k.push(d.nextLeftEdge),m.push(p),c=d):null==l&&(h.setDatas(d.destinationVertex,p,null,null,!0,!0),m.push(d.nextLeftEdge),l=d):null==c?m.push(d.nextLeftEdge):null==l?k.push(d.nextLeftEdge):m.push(d.nextLeftEdge);n=c.leftFace.isReal;g=l.leftFace.isReal;h.fromConstraintSegments=c.fromConstraintSegments.slice(0);p.fromConstraintSegments=h.fromConstraintSegments;for(var r,q=0,s=a.fromConstraintSegments.length;q<s;)d=q++,d=a.fromConstraintSegments[d].edges,r=d.indexOf(c),-1!=r?(d.splice(r-
1,2),d.splice(r-1,0,h)):(r=d.indexOf(l)-1,d.splice(r,2),d.splice(r,0,p))}c=0;for(l=e.length;c<l;)h=c++,d=e[h],h=d.leftFace,this._faces.splice(this._faces.indexOf(h),1),h.dispose(),d.destinationVertex.edge=d.nextLeftEdge,this._edges.splice(this._edges.indexOf(d.oppositeEdge),1),d.oppositeEdge.dispose(),this._edges.splice(this._edges.indexOf(d),1),d.dispose();this._vertices.splice(this._vertices.indexOf(a),1);a.dispose();b?this.triangulate(f,!0):(this.triangulate(k,n),this.triangulate(m,g));return!0},
untriangulate:function(a){for(var b=new DDLS.Dictionary,c,d=0,e=a.length;d<e;){var f=d++;c=a[f];null==b.get(c.originVertex)&&(c.originVertex.edge=c.prevLeftEdge.oppositeEdge,b.set(c.originVertex,!0));null==b.get(c.destinationVertex)&&(c.destinationVertex.edge=c.nextLeftEdge,b.set(c.destinationVertex,!0));this._faces.splice(this._faces.indexOf(c.leftFace),1);c.leftFace.dispose();f==a.length-1&&(this._faces.splice(this._faces.indexOf(c.rightFace),1),c.rightFace.dispose())}b=0;for(d=a.length;b<d;)c=
b++,c=a[c],this._edges.splice(this._edges.indexOf(c.oppositeEdge),1),this._edges.splice(this._edges.indexOf(c),1),c.oppositeEdge.dispose(),c.dispose()},triangulate:function(a,b){if(2>a.length)DDLS.Log("BREAK ! the hole has less than 2 edges");else if(2==a.length)DDLS.Log("BREAK ! the hole has only 2 edges");else if(3==a.length){var c=new DDLS.Face;c.setDatas(a[0],b);this._faces.push(c);a[0].leftFace=c;a[1].leftFace=c;a[2].leftFace=c;a[0].nextLeftEdge=a[1];a[1].nextLeftEdge=a[2];a[2].nextLeftEdge=
a[0]}else{for(var c=a[0],d=c.originVertex,e=c.destinationVertex,f,n,g=new DDLS.Point,k=!1,m=0,l=2,h=a.length;l<h;){var p=l++;f=a[p].originVertex;if(1==DDLS.Geom2D.getRelativePosition2(f.pos.x,f.pos.y,c)){m=p;k=!0;DDLS.Geom2D.getCircumcenter(d.pos.x,d.pos.y,e.pos.x,e.pos.y,f.pos.x,f.pos.y,g);f=(d.pos.x-g.x)*(d.pos.x-g.x)+(d.pos.y-g.y)*(d.pos.y-g.y);f-=DDLS.EPSILON_SQUARED;for(var r=2,q=a.length;r<q;)if(n=r++,n!=p&&(n=a[n].originVertex,n=(n.pos.x-g.x)*(n.pos.x-g.x)+(n.pos.y-g.y)*(n.pos.y-g.y),n<f)){k=
!1;break}if(k)break}}if(!k){DDLS.Log("NO DELAUNAY FOUND");m=0;for(e=a.length;m<e;)m++;m=2}g=e=k=null;m<a.length-1&&(k=new DDLS.Edge,e=new DDLS.Edge,this._edges.push(k),this._edges.push(e),k.setDatas(d,e,null,null,b,!1),e.setDatas(a[m].originVertex,k,null,null,b,!1),d=a.slice(m),d.push(k),this.triangulate(d,b));2<m&&(g=new DDLS.Edge,d=new DDLS.Edge,this._edges.push(g),this._edges.push(d),g.setDatas(a[1].originVertex,d,null,null,b,!1),d.setDatas(a[m].originVertex,g,null,null,b,!1),k=a.slice(1,m),k.push(d),
this.triangulate(k,b));this.triangulate(2==m?[c,a[1],e]:m==a.length-1?[c,g,a[m]]:[c,g,e],b)}},findPositionFromBounds:function(a,b){return 0>=a?0>=b?1:b>=this.height?7:8:a>=this.width?0>=b?3:b>=this.height?5:4:0>=b?2:b>=this.height?6:0},debug:function(){for(var a=0,b=this._vertices.length;a<b;){var c=a++;DDLS.Debug.trace("-- vertex "+this._vertices[c].id,{fileName:"Mesh.hx",lineNumber:1568,className:"DDLS.Mesh",methodName:"debug"});DDLS.Debug.trace("  edge "+this._vertices[c].edge.id+" - "+this._vertices[c].edge.toString(),
{fileName:"Mesh.hx",lineNumber:1569,className:"DDLS.Mesh",methodName:"debug"});DDLS.Debug.trace("  edge isReal: "+this._vertices[c].edge.isReal.toString(),{fileName:"Mesh.hx",lineNumber:1570,className:"DDLS.Mesh",methodName:"debug"})}a=0;for(b=this._edges.length;a<b;)c=a++,DDLS.Debug.trace("-- edge "+this._edges[c].toString(),{fileName:"Mesh.hx",lineNumber:1573,className:"DDLS.Mesh",methodName:"debug"}),DDLS.Debug.trace("  isReal "+this._edges[c].id+" - "+this._edges[c].isReal.toString(),{fileName:"Mesh.hx",
lineNumber:1574,className:"DDLS.Mesh",methodName:"debug"}),DDLS.Debug.trace("  nextLeftEdge "+this._edges[c].nextLeftEdge.toString(),{fileName:"Mesh.hx",lineNumber:1575,className:"DDLS.Mesh",methodName:"debug"}),DDLS.Debug.trace("  oppositeEdge "+this._edges[c].oppositeEdge.toString(),{fileName:"Mesh.hx",lineNumber:1576,className:"DDLS.Mesh",methodName:"debug"})},traverse:function(a,b){var c,d;d=new DDLS.FromMeshToVertices;d.fromMesh=this;var e;e=new DDLS.FromVertexToIncomingEdges;for(var f=new DDLS.Dictionary;null!=
(c=d.next());)if(f.set(c,!0),this.vertexIsInsideAABB(c,this))for(a(c),e.fromVertex=c;null!=(c=e.next());)f.get(c.originVertex)||b(c)},vertexIsInsideAABB:function(a,b){return 0>a.pos.x||a.pos.x>b.width||0>a.pos.y||a.pos.y>b.height?!1:!0}};DDLS.Graph=function(){this.id=DDLS.GraphID;DDLS.GraphID++;this.node=this.edge=null};
DDLS.Graph.prototype={dispose:function(){for(;null!=this.node;)this.deleteNode(this.node)},insertNode:function(){var a=new DDLS.GraphNode;null!=this.node&&(a.next=this.node,this.node.prev=a);return this.node=a},deleteNode:function(a){for(;null!=a.outgoingEdge;)null!=a.outgoingEdge.oppositeEdge&&this.deleteEdge(a.outgoingEdge.oppositeEdge),this.deleteEdge(a.outgoingEdge);for(var b=this.node,c;null!=b;)c=b.successorNodes.get(a),null!=c&&this.deleteEdge(c),b=b.next;this.node==a?null!=a.next?(a.next.prev=
null,this.node=a.next):this.node=null:null!=a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null;a.dispose()},insertEdge:function(a,b){if(null!=a.successorNodes.get(b))return null;var c=new DDLS.GraphEdge;null!=this.edge&&(this.edge.prev=c,c.next=this.edge);this.edge=c;c.sourceNode=a;c.destinationNode=b;a.successorNodes.set(b,c);null!=a.outgoingEdge&&(a.outgoingEdge.rotPrevEdge=c,c.rotNextEdge=a.outgoingEdge);a.outgoingEdge=c;var d;d=b.successorNodes.get(a);null!=d&&(c.oppositeEdge=d,d.oppositeEdge=
c);return c},deleteEdge:function(a){this.edge==a?null!=a.next?(a.next.prev=null,this.edge=a.next):this.edge=null:null!=a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null;a.sourceNode.outgoingEdge==a?null!=a.rotNextEdge?(a.rotNextEdge.rotPrevEdge=null,a.sourceNode.outgoingEdge=a.rotNextEdge):a.sourceNode.outgoingEdge=null:null!=a.rotNextEdge?(a.rotPrevEdge.rotNextEdge=a.rotNextEdge,a.rotNextEdge.rotPrevEdge=a.rotPrevEdge):a.rotPrevEdge.rotNextEdge=null;a.dispose()}};
DDLS.GraphEdge=function(){this.id=DDLS.GraphEdgeID;DDLS.GraphEdgeID++;this.data=this.destinationNode=this.sourceNode=this.oppositeEdge=this.rotNextEdge=this.rotPrevEdge=this.prev=this.next=null};DDLS.GraphEdge.prototype={dispose:function(){}};DDLS.GraphNode=function(){this.id=DDLS.GraphNodeID;DDLS.GraphNodeID++;this.successorNodes=new DDLS.Dictionary;this.data=this.outgoingEdge=this.next=this.prev=null};
DDLS.GraphNode.prototype={dispose:function(){this.data=this.successorNodes=this.outgoingEdge=this.next=this.prev=null}};DDLS.EdgeData=function(){};DDLS.NodeData=function(){};DDLS.Potrace={};DDLS.Potrace.MAX_INT=2147483647;DDLS.Potrace.maxDistance=1;
DDLS.Potrace.buildShapes=function(a,b,c){for(var d=[],e=new DDLS.StringMap,f=1,n=a.height-1;f<n;)for(var g=f++,k=0,m=a.width-1;k<m;){var l=k++;16777215==function(b){b=g*a.width+l<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]}(this)&&16777215>function(b){b=g*a.width+(l+1)<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]}(this)&&(e.get(l+1+"_"+g)||d.push(DDLS.Potrace.buildShape(a,g,l+1,e,b,c)))}return d};
DDLS.Potrace.buildShape=function(a,b,c,d,e,f){var n=c,g=b,k=[n,g];d.set(n+"_"+g,!0);for(var m=new DDLS.Point(0,1),l=new DDLS.Point,h,p,r=-1;;){if(null!=e){var q=b*e.width+c<<2;e.bytes.b[q]=255;e.bytes.b[q+1]=255;e.bytes.b[q+2]=0;e.bytes.b[q+3]=0}h=b+m.x+m.y|0;p=c+m.x-m.y|0;16777215>function(b){b=h*a.width+p<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]}(this)?(l.x=-m.y,l.y=m.x):(h=b+m.y|0,p=c+m.x|0,16777215>function(b){b=h*a.width+p<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+
3]}(this)?(l.x=m.x,l.y=m.y):(h=b,p=c,l.x=m.y,l.y=-m.x));n+=m.x;g+=m.y;if(n==k[0]&&g==k[1])break;else k.push(n),k.push(g),d.set(n+"_"+g,!0),b=h,c=p,m.x=l.x,m.y=l.y;r--;if(0==r)break}if(null!=f){f.graphics.lineStyle(0.5,65280,1);f.graphics.moveTo(k[0],k[1]);for(b=2;b<k.length;)f.graphics.lineTo(k[b],k[b+1]),b+=2;f.graphics.lineTo(k[0],k[1])}return k};
DDLS.Potrace.buildGraph=function(a){var b,c=new DDLS.Graph,d;for(b=0;b<a.length;)d=c.insertNode(),d.data=new DDLS.NodeData,d.data.index=b,d.data.point=new DDLS.Point(a[b],a[b+1]),b+=2;var e,f,n,g;for(a=c.node;null!=a;){for(b=null!=a.next?a.next:c.node;b!=a;){g=!0;e=null!=a.next?a.next:c.node;n=2;for(d=0;e!=b;){f=DDLS.Geom2D.distanceSquaredPointToSegment(e.data.point.x,e.data.point.y,a.data.point.x,a.data.point.y,b.data.point.x,b.data.point.y);0>f&&(f=0);if(f>=DDLS.Potrace.maxDistance){g=!1;break}n++;
d+=f;e=null!=e.next?e.next:c.node}if(!g)break;e=c.insertEdge(a,b);f=new DDLS.EdgeData;f.sumDistancesSquared=d;f.length=a.data.point.distanceTo(b.data.point);f.nodesCount=n;e.data=f;b=null!=b.next?b.next:c.node}a=a.next}return c};
DDLS.Potrace.buildPolygon=function(a,b){var c=[],d,e=2147483647,f,n,g=null;for(d=a.node;d.data.index<e;){e=d.data.index;c.push(d.data.point.x);c.push(d.data.point.y);n=0;for(d=d.outgoingEdge;null!=d;)f=d.data.nodesCount-d.data.length*DDLS.sqrt(d.data.sumDistancesSquared/d.data.nodesCount),f>n&&(n=f,g=d),d=d.rotNextEdge;d=g.destinationNode}0==DDLS.Geom2D.getDirection(c[c.length-2],c[c.length-1],c[0],c[1],c[2],c[3])&&(c.shift(),c.shift());if(null!=b){b.graphics.lineStyle(0.5,255);b.graphics.moveTo(c[0],
c[1]);for(e=2;e<c.length;)b.graphics.lineTo(c[e],c[e+1]),e+=2;b.graphics.lineTo(c[0],c[1])}return c};DDLS.ShapeSimplifier=function(a,b){null==b&&(b=1);var c=a.length;DDLS.Debug.assertFalse(0!=(c&1),"Wrong size",{fileName:"ShapeSimplifier.hx",lineNumber:18,className:"DDLS.ShapeSimplifier",methodName:"simplify"});if(4>=c)return[].concat(a);for(var d=a[0],e=a[1],f=a[c-2],n=a[c-1],g=-1,k=0,m=1,c=c>>1;m<c;){var l=m++,h=DDLS.Geom2D.distanceSquaredPointToSegment(a[l<<1],a[(l<<1)+1],d,e,f,n);h>k&&(k=h,g=l)}return k>b*b?(d=a.slice(0,(g<<1)+2),g=a.slice(g<<1),d=DDLS.ShapeSimplifier(d,b),g=DDLS.ShapeSimplifier(g,
b),d.slice(0,d.length-2).concat(g)):[d,e,f,n]};DDLS.AStar=function(){this.iterEdge=new DDLS.FromFaceToInnerEdges;Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(a){this._radius=a;this.radiusSquared=this._radius*this._radius;this.diameter=2*this._radius;this.diameterSquared=this.diameter*this.diameter}})};
DDLS.AStar.prototype={dispose:function(){this.predecessor=this.scoreH=this.scoreG=this.scoreF=this.entryY=this.entryX=this.entryEdges=this.openedFaces=this.sortedOpenedFaces=this.closedFaces=this.mesh=null},findPath:function(a,b,c,d,e,f){this.closedFaces=new DDLS.Dictionary;this.sortedOpenedFaces=[];this.openedFaces=new DDLS.Dictionary;this.entryEdges=new DDLS.Dictionary;this.entryX=new DDLS.Dictionary;this.entryY=new DDLS.Dictionary;this.scoreF=new DDLS.Dictionary;this.scoreG=new DDLS.Dictionary;
this.scoreH=new DDLS.Dictionary;this.predecessor=new DDLS.Dictionary;var n;n=DDLS.Geom2D.locatePosition(a,b,this.mesh);switch(n[1]){case 0:return;case 1:n=n[2];if(n.isConstrained)return;this.fromFace=n.leftFace;break;case 2:this.fromFace=n[2]}n=DDLS.Geom2D.locatePosition(c,d,this.mesh);switch(n[1]){case 0:n=n[2];this.toFace=n.edge.leftFace;break;case 1:n=n[2];this.toFace=n.leftFace;break;case 2:this.toFace=n[2]}this.sortedOpenedFaces.push(this.fromFace);this.entryEdges.set(this.fromFace,null);this.entryX.set(this.fromFace,
a);this.entryY.set(this.fromFace,b);this.scoreG.set(this.fromFace,0);a=DDLS.sqrt((c-a)*(c-a)+(d-b)*(d-b));this.scoreH.set(this.fromFace,a);this.scoreF.set(this.fromFace,a);for(var g,k,m=new DDLS.Point,l=new DDLS.Point,h=new DDLS.Point,p;;){if(0==this.sortedOpenedFaces.length){DDLS.Log("AStar no path found",{fileName:"AStar.hx",lineNumber:157,className:"DDLS.AStar",methodName:"findPath"});this.curFace=null;break}this.curFace=this.sortedOpenedFaces.pop();if(this.curFace==this.toFace)break;for(this.iterEdge.fromFace=
this.curFace;null!=(a=this.iterEdge.next());)a.isConstrained||(b=a.rightFace,this.closedFaces.get(b)||this.curFace!=this.fromFace&&0<this._radius&&!this.isWalkableByRadius(this.entryEdges.get(this.curFace),this.curFace,a)||(m.x=this.entryX.get(this.curFace),m.y=this.entryY.get(this.curFace),l.x=m.x,l.y=m.y,l.x=0.5*(a.originVertex.pos.x+a.destinationVertex.pos.x),l.y=0.5*(a.originVertex.pos.y+a.destinationVertex.pos.y),h.x=l.x-c,h.y=l.y-d,k=h.get_length(),h.x=m.x-l.x,h.y=m.y-l.y,g=this.scoreG.get(this.curFace)+
h.get_length(),n=k+g,p=!1,null!=this.openedFaces.get(b)&&this.openedFaces.get(b)?this.scoreF.get(b)>n&&(p=!0):(this.sortedOpenedFaces.push(b),this.openedFaces.set(b,!0),p=!0),p&&(this.entryEdges.set(b,a),this.entryX.set(b,l.x),this.entryY.set(b,l.y),this.scoreF.set(b,n),this.scoreG.set(b,g),this.scoreH.set(b,k),this.predecessor.set(b,this.curFace))));this.openedFaces.set(this.curFace,!1);this.closedFaces.set(this.curFace,!0);this.sortedOpenedFaces.sort(DDLS.Bind(this,this.sortingFaces))}if(null!=
this.curFace)for(e.push(this.curFace);this.curFace!=this.fromFace;)f.unshift(this.entryEdges.get(this.curFace)),this.curFace=this.predecessor.get(this.curFace),e.unshift(this.curFace)},sortingFaces:function(a,b){return this.scoreF.get(a)==this.scoreF.get(b)?0:this.scoreF.get(a)<this.scoreF.get(b)?1:-1},isWalkableByRadius:function(a,b,c){var d=null,e=null,f=null;a.originVertex==c.originVertex?(d=a.destinationVertex,e=c.destinationVertex,f=a.originVertex):a.destinationVertex==c.destinationVertex?(d=
a.originVertex,e=c.originVertex,f=a.destinationVertex):a.originVertex==c.destinationVertex?(d=a.destinationVertex,e=c.originVertex,f=a.originVertex):a.destinationVertex==c.originVertex&&(d=a.originVertex,e=c.destinationVertex,f=a.destinationVertex);var n;n=(f.pos.x-d.pos.x)*(e.pos.x-d.pos.x)+(f.pos.y-d.pos.y)*(e.pos.y-d.pos.y);if(0>=n)return f=(f.pos.x-d.pos.x)*(f.pos.x-d.pos.x)+(f.pos.y-d.pos.y)*(f.pos.y-d.pos.y),f>=this.diameterSquared?!0:!1;n=(f.pos.x-e.pos.x)*(d.pos.x-e.pos.x)+(f.pos.y-e.pos.y)*
(d.pos.y-e.pos.y);if(0>=n)return f=(f.pos.x-e.pos.x)*(f.pos.x-e.pos.x)+(f.pos.y-e.pos.y)*(f.pos.y-e.pos.y),f>=this.diameterSquared?!0:!1;c=b.edge!=a&&b.edge.oppositeEdge!=a&&b.edge!=c&&b.edge.oppositeEdge!=c?b.edge:b.edge.nextLeftEdge!=a&&b.edge.nextLeftEdge.oppositeEdge!=a&&b.edge.nextLeftEdge!=c&&b.edge.nextLeftEdge.oppositeEdge!=c?b.edge.nextLeftEdge:b.edge.prevLeftEdge;if(c.isConstrained)return b=new DDLS.Point(f.pos.x,f.pos.y),DDLS.Geom2D.projectOrthogonaly(b,c),f=(b.x-f.pos.x)*(b.x-f.pos.x)+
(b.y-f.pos.y)*(b.y-f.pos.y),f>=this.diameterSquared?!0:!1;e=(f.pos.x-e.pos.x)*(f.pos.x-e.pos.x)+(f.pos.y-e.pos.y)*(f.pos.y-e.pos.y);if((f.pos.x-d.pos.x)*(f.pos.x-d.pos.x)+(f.pos.y-d.pos.y)*(f.pos.y-d.pos.y)<this.diameterSquared||e<this.diameterSquared)return!1;d=[];e=[];a=new DDLS.Dictionary;e.push(c);c.leftFace==b?(d.push(c.rightFace),a.set(c.rightFace,!0)):(d.push(c.leftFace),a.set(c.leftFace,!0));for(var g;0<d.length;){b=d.shift();c=e.shift();b.edge==c||b.edge==c.oppositeEdge?(c=b.edge.nextLeftEdge,
g=b.edge.nextLeftEdge.nextLeftEdge):b.edge.nextLeftEdge==c||b.edge.nextLeftEdge==c.oppositeEdge?(c=b.edge,g=b.edge.nextLeftEdge.nextLeftEdge):(c=b.edge,g=b.edge.nextLeftEdge);n=c.leftFace==b?c.rightFace:c.leftFace;b=g.leftFace==b?g.rightFace:g.leftFace;if(!a.get(n)&&DDLS.Geom2D.distanceSquaredVertexToEdge(f,c)<this.diameterSquared){if(c.isConstrained)return!1;d.push(n);e.push(c);a.set(n,!0)}if(!a.get(b)&&DDLS.Geom2D.distanceSquaredVertexToEdge(f,g)<this.diameterSquared){if(g.isConstrained)return!1;
d.push(b);e.push(g);a.set(b,!0)}}return!0}};DDLS.EntityAI=function(){this._radius=10;this.radiusSquared=100;this.x=this.y=0;this.dirNormX=1;this.dirNormY=0;this.angleFOV=60;this._radiusSquaredFOV=this._radiusFOV=0;Object.defineProperty(this,"radiusFOV",{get:function(){return this._radiusFOV},set:function(a){this._radiusFOV=a;this._radiusSquaredFOV=this._radiusFOV*this._radiusFOV}});Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(a){this._radius=a;this.radiusSquared=this._radius*this._radius}});Object.defineProperty(this,
"approximateObject",{get:function(){this._approximateObject.matrix.identity();this._approximateObject.matrix.translate(this.x,this.y);return this._approximateObject}})};
DDLS.EntityAI.prototype={buildApproximation:function(){this._approximateObject=new DDLS.Object;this._approximateObject.matrix.translate(this.x,this.y);var a=[];this._approximateObject.coordinates=a;if(0!=this._radius)for(var b=0;6>b;){var c=b++;a.push(this._radius*DDLS.cos(DDLS.TwoPI*c/6));a.push(this._radius*DDLS.sin(DDLS.TwoPI*c/6));a.push(this._radius*DDLS.cos(DDLS.TwoPI*(c+1)/6));a.push(this._radius*DDLS.sin(DDLS.TwoPI*(c+1)/6))}},get_approximateObject:function(){this._approximateObject.matrix.identity();
this._approximateObject.matrix.translate(this.x,this.y);return this._approximateObject}};DDLS.EntityAI.NUM_SEGMENTS=6;DDLS.Funnel=function(){this._currPoolPointsIndex=0;this._poolPointsSize=3E3;this._numSamplesCircle=16;this._radius=this._radiusSquared=0;this._poolPoints=[];for(var a=0,b=this._poolPointsSize;a<b;)a++,this._poolPoints.push(new DDLS.Point);Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(a){this._radius=DDLS.max(0,a);this._radiusSquared=this._radius*this._radius;this._sampleCircle=[];if(0!=this._radius){a=0;for(var b=this._numSamplesCircle;a<b;){var e=a++;this._sampleCircle.push(new DDLS.Point(this._radius*
DDLS.cos(-DDLS.TwoPI*e/this._numSamplesCircle),this._radius*DDLS.sin(-DDLS.TwoPI*e/this._numSamplesCircle)))}this._sampleCircleDistanceSquared=(this._sampleCircle[0].x-this._sampleCircle[1].x)*(this._sampleCircle[0].x-this._sampleCircle[1].x)+(this._sampleCircle[0].y-this._sampleCircle[1].y)*(this._sampleCircle[0].y-this._sampleCircle[1].y)}}})};
DDLS.Funnel.prototype={dispose:function(){this._sampleCircle=null},getPoint:function(a,b){null==b&&(b=0);null==a&&(a=0);this.__point=this._poolPoints[this._currPoolPointsIndex];this.__point.setXY(a,b);this._currPoolPointsIndex++;this._currPoolPointsIndex==this._poolPointsSize&&(this._poolPoints.push(new DDLS.Point),this._poolPointsSize++);return this.__point},getCopyPoint:function(a){return this.getPoint(a.x,a.y)},findPath:function(a,b,c,d,e,f,n){this._currPoolPointsIndex=0;if(0<this._radius){var g=
e[0],k,m,l;m=g.edge.originVertex.pos;l=g.edge.destinationVertex.pos;g=g.edge.nextLeftEdge.destinationVertex.pos;k=(m.x-a)*(m.x-a)+(m.y-b)*(m.y-b);k<=this._radiusSquared?(k=DDLS.sqrt(k),a=(a-m.x)/k*this._radius*1.01+m.x,b=(b-m.y)/k*this._radius*1.01+m.y):(k=(l.x-a)*(l.x-a)+(l.y-b)*(l.y-b),k<=this._radiusSquared?(k=DDLS.sqrt(k),a=(a-l.x)/k*this._radius*1.01+l.x,b=(b-l.y)/k*this._radius*1.01+l.y):(k=(g.x-a)*(g.x-a)+(g.y-b)*(g.y-b),k<=this._radiusSquared&&(k=DDLS.sqrt(k),a=(a-g.x)/k*this._radius*1.01+
g.x,b=(b-g.y)/k*this._radius*1.01+g.y)));g=e[e.length-1];m=g.edge.originVertex.pos;l=g.edge.destinationVertex.pos;g=g.edge.nextLeftEdge.destinationVertex.pos;k=(m.x-c)*(m.x-c)+(m.y-d)*(m.y-d);k<=this._radiusSquared?(k=DDLS.sqrt(k),c=(c-m.x)/k*this._radius*1.01+m.x,d=(d-m.y)/k*this._radius*1.01+m.y):(k=(l.x-c)*(l.x-c)+(l.y-d)*(l.y-d),k<=this._radiusSquared?(k=DDLS.sqrt(k),c=(c-l.x)/k*this._radius*1.01+l.x,d=(d-l.y)/k*this._radius*1.01+l.y):(k=(g.x-c)*(g.x-c)+(g.y-d)*(g.y-d),k<=this._radiusSquared&&
(k=DDLS.sqrt(k),c=(c-g.x)/k*this._radius*1.01+g.x,d=(d-g.y)/k*this._radius*1.01+g.y)))}var h;h=new DDLS.Point(a,b);m=new DDLS.Point(c,d);if(1==e.length)n.push(h.x),n.push(h.y),n.push(m.x),n.push(m.y);else{var p=null,r=null;l=DDLS.Geom2D.isInFace(a,b,e[0]);switch(l[1]){case 1:f[0]==l[2]&&(f.shift(),e.shift())}g=[];k=[];g.push(h);k.push(h);var q=new DDLS.Dictionary,s=[];e=new DDLS.Dictionary;l=new DDLS.Dictionary;e.set(h,0);var p=f[0],t=DDLS.Geom2D.getRelativePosition2(a,b,p),v;b=this.getCopyPoint(p.destinationVertex.pos);
v=this.getCopyPoint(p.originVertex.pos);s.push(b);s.push(v);l.set(h,b);l.set(b,v);a=v;1==t?(e.set(b,1),e.set(v,-1),q.set(p.destinationVertex,1),q.set(p.originVertex,-1)):-1==t&&(e.set(b,-1),e.set(v,1),q.set(p.destinationVertex,-1),q.set(p.originVertex,1));t=f[0].originVertex;b=f[0].destinationVertex;v=1;for(var u=f.length;v<u;)p=v++,p=f[p],p.originVertex==t?r=p.destinationVertex:p.destinationVertex==t?r=p.originVertex:p.originVertex==b?(r=p.destinationVertex,t=b):p.destinationVertex==b?(r=p.originVertex,
t=b):DDLS.Log("IMPOSSIBLE TO IDENTIFY THE VERTEX !!!"),b=this.getCopyPoint(r.pos),s.push(b),p=-q.get(t),e.set(b,p),l.set(a,b),q.set(r,p),a=b,b=t,t=r;l.set(a,m);e.set(m,0);f=[];r=new DDLS.Dictionary;f.push(h);r.set(h,0);q=0;for(a=s.length;q<a;)if(h=q++,b=s[h],-1==e.get(b)){for(h=g.length-2;0<=h;){p=DDLS.Geom2D.getDirection(g[h].x,g[h].y,g[h+1].x,g[h+1].y,b.x,b.y);if(-1!=p){g.shift();for(p=0;p<h;)p++,f.push(g[0]),r.set(g[0],1),g.shift();f.push(g[0]);r.set(g[0],1);k.splice(0,k.length);k.push(g[0]);k.push(b);
break}h--}k.push(b);for(h=k.length-3;0<=h;){p=DDLS.Geom2D.getDirection(k[h].x,k[h].y,k[h+1].x,k[h+1].y,b.x,b.y);if(-1==p)break;else k.splice(h+1,1);h--}}else{for(h=k.length-2;0<=h;){p=DDLS.Geom2D.getDirection(k[h].x,k[h].y,k[h+1].x,k[h+1].y,b.x,b.y);if(1!=p){k.shift();for(p=0;p<h;)p++,f.push(k[0]),r.set(k[0],-1),k.shift();f.push(k[0]);r.set(k[0],-1);g.splice(0,g.length);g.push(k[0]);g.push(b);break}h--}g.push(b);for(h=g.length-3;0<=h;){p=DDLS.Geom2D.getDirection(g[h].x,g[h].y,g[h+1].x,g[h+1].y,b.x,
b.y);if(1==p)break;else g.splice(h+1,1);h--}}s=!1;for(h=k.length-2;0<=h;){p=DDLS.Geom2D.getDirection(k[h].x,k[h].y,k[h+1].x,k[h+1].y,c,d);if(1!=p){k.shift();s=0;for(h+=1;s<h;)s++,f.push(k[0]),r.set(k[0],-1),k.shift();f.push(m);r.set(m,0);s=!0;break}h--}if(!s)for(h=g.length-2;0<=h;){p=DDLS.Geom2D.getDirection(g[h].x,g[h].y,g[h+1].x,g[h+1].y,c,d);if(-1!=p){g.shift();c=0;for(d=h+1;c<d;)c++,f.push(g[0]),r.set(g[0],1),g.shift();f.push(m);r.set(m,0);s=!0;break}h--}s||(f.push(m),r.set(m,0));c=[];if(0<this._radius){d=
[];if(2==f.length)this.adjustWithTangents(f[0],!1,f[1],!1,e,l,d,c);else if(2<f.length){this.adjustWithTangents(f[0],!1,f[1],!0,e,l,d,c);if(3<f.length)for(g=1,k=f.length-3+1;g<k;)s=g++,this.adjustWithTangents(f[s],!0,f[s+1],!0,e,l,d,c);g=f.length;this.adjustWithTangents(f[g-2],!0,f[g-1],!1,e,l,d,c)}d.push(m);this.checkAdjustedPath(d,c,e);l=[];for(m=d.length-2;1<=m;){for(this.smoothAngle(c[2*m-1],d[m],c[2*m],e.get(d[m]),l);0!=l.length;)g=2*m,c.splice(g,0),k=l.pop(),c.splice(g,0,k);m--}}else c=f;e=0;
for(m=c.length;e<m;)d=e++,n.push(c[d].x),n.push(c[d].y)}},adjustWithTangents:function(a,b,c,d,e,f,n,g){var k=[],m=e.get(a),l=e.get(c),h=null,p=null;if(b||d)if(b)if(d)if(1==m&&1==l)DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,a.x,a.y,c.x,c.y,k),h=this.getPoint(k[2],k[3]),p=this.getPoint(k[4],k[5]);else if(-1==m&&-1==l)DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,a.x,a.y,c.x,c.y,k),h=this.getPoint(k[0],k[1]),p=this.getPoint(k[6],k[7]);else if(1==m&&-1==l)if(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,
a.x,a.y,c.x,c.y,k))h=this.getPoint(k[2],k[3]),p=this.getPoint(k[6],k[7]);else{DDLS.Log("NO TANGENT, points are too close for radius");return}else if(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,a.x,a.y,c.x,c.y,k))h=this.getPoint(k[0],k[1]),p=this.getPoint(k[4],k[5]);else{DDLS.Log("NO TANGENT, points are too close for radius");return}else if(DDLS.Geom2D.tangentsPointToCircle(c.x,c.y,a.x,a.y,this._radius,k))0<k.length&&(h=1==m?this.getPoint(k[0],k[1]):this.getPoint(k[2],k[3]),p=c);else{DDLS.Log("NO TANGENT");
return}else if(DDLS.Geom2D.tangentsPointToCircle(a.x,a.y,c.x,c.y,this._radius,k))1==l?(h=a,p=this.getPoint(k[2],k[3])):(h=a,p=this.getPoint(k[0],k[1]));else{DDLS.Log("NO TANGENT");return}else h=a,p=c;for(k=f.get(a);k!=c;){m=DDLS.Geom2D.distanceSquaredPointToSegment(k.x,k.y,h.x,h.y,p.x,p.y);if(m<this._radiusSquared){this.adjustWithTangents(a,b,k,!0,e,f,n,g);this.adjustWithTangents(k,!0,c,d,e,f,n,g);return}k=f.get(k)}g.push(h);g.push(p);n.push(a)},checkAdjustedPath:function(a,b,c){for(var d=!0,e,f,
n,g,k,m,l,h=[],p=null,r=null;d;)for(var d=!1,q=2;q<a.length;)g=a[q],k=c.get(g),e=a[q-1],n=c.get(e),e=a[q-2],f=c.get(e),n==k&&(n=b[2*(q-2)],m=b[2*(q-1)-1],l=b[2*(q-1)],n=(n.x-m.x)*(l.x-m.x)+(n.y-m.y)*(l.y-m.y),0<n&&(2==q?(DDLS.Geom2D.tangentsPointToCircle(e.x,e.y,g.x,g.y,this._radius,h),1==k?(p=e,r=this.getPoint(h[2],h[3])):(p=e,r=this.getPoint(h[0],h[1]))):q==a.length-1?(DDLS.Geom2D.tangentsPointToCircle(g.x,g.y,e.x,e.y,this._radius,h),p=1==f?this.getPoint(h[0],h[1]):this.getPoint(h[2],h[3]),r=g):
1==f&&-1==k?(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,e.x,e.y,g.x,g.y,h),p=this.getPoint(h[2],h[3]),r=this.getPoint(h[6],h[7])):-1==f&&1==k?(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,e.x,e.y,g.x,g.y,h),p=this.getPoint(h[0],h[1]),r=this.getPoint(h[4],h[5])):1==f&&1==k?(DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,e.x,e.y,g.x,g.y,h),p=this.getPoint(h[2],h[3]),r=this.getPoint(h[4],h[5])):-1==f&&-1==k&&(DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,e.x,e.y,g.x,g.y,
h),p=this.getPoint(h[0],h[1]),r=this.getPoint(h[6],h[7])),g=2*(q-2),b.splice(g,1),b.splice(g,0,p),g=2*q-1,b.splice(g,1),b.splice(g,0,r),a.splice(q-1,1),b.splice(2*(q-1)-1,2),h.splice(0,h.length),q--)),q++},smoothAngle:function(a,b,c,d,e){var f=DDLS.Geom2D.getDirection(a.x,a.y,b.x,b.y,c.x,c.y);if(!((a.x-c.x)*(a.x-c.x)+(a.y-c.y)*(a.y-c.y)<=this._sampleCircleDistanceSquared)){for(var n=0,g,k,m,l,h,p=0,r=this._numSamplesCircle;p<r;){g=p++;m=!1;l=b.x+this._sampleCircle[g].x;h=b.y+this._sampleCircle[g].y;
g=DDLS.Geom2D.getDirection(a.x,a.y,b.x,b.y,l,h);k=DDLS.Geom2D.getDirection(b.x,b.y,c.x,c.y,l,h);if(1==d)if(-1==f)-1==g&&-1==k&&(m=!0);else{if(-1==g||-1==k)m=!0}else if(1==f)1==g&&1==k&&(m=!0);else if(1==g||1==k)m=!0;m?(e.splice(n,0),m=new DDLS.Point(l,h),e.splice(n,0,m),n++):n=0}-1==d&&e.reverse()}}};DDLS.PathFinder=function(){this.astar=new DDLS.AStar;this.funnel=new DDLS.Funnel;this.listFaces=[];this.listEdges=[];this.entity=this._mesh=null;Object.defineProperty(this,"mesh",{get:function(){return this._mesh},set:function(a){this._mesh=a;this.astar.mesh=a}})};
DDLS.PathFinder.prototype={dispose:function(){this._mesh=null;this.astar.dispose();this.astar=null;this.funnel.dispose();this.listFaces=this.listEdges=this.funnel=null},findPath:function(a,b,c){c.splice(0,c.length);DDLS.Debug.assertFalse(null==this._mesh,"Mesh missing",{fileName:"PathFinder.hx",lineNumber:51,className:"DDLS.PathFinder",methodName:"findPath"});DDLS.Debug.assertFalse(null==this.entity,"Entity missing",{fileName:"PathFinder.hx",lineNumber:52,className:"DDLS.PathFinder",methodName:"findPath"});
DDLS.Geom2D.isCircleIntersectingAnyConstraint(a,b,this.entity.radius,this._mesh)||(this.astar.radius=this.entity.radius,this.funnel.radius=this.entity.radius,this.listFaces.splice(0,this.listFaces.length),this.listEdges.splice(0,this.listEdges.length),this.astar.findPath(this.entity.x,this.entity.y,a,b,this.listFaces,this.listEdges),0==this.listFaces.length?DDLS.Log("PathFinder listFaces.length == 0",{fileName:"PathFinder.hx",lineNumber:63,className:"DDLS.PathFinder",methodName:"findPath"}):this.funnel.findPath(this.entity.x,
this.entity.y,a,b,this.listFaces,this.listEdges,c))}};DDLS.FieldOfView=function(){this._mesh=this._fromEntity=null;this._debug=!1;Object.defineProperty(this,"fromEntity",{get:function(){return this._fromEntity},set:function(a){this._fromEntity=a}});Object.defineProperty(this,"mesh",{get:function(){return this._mesh}})};
DDLS.FieldOfView.prototype={isInField:function(a){if(this._mesh&&this._fromEntity){var b=this._fromEntity.x,c=this._fromEntity.y,d=this._fromEntity.dirNormX,e=this._fromEntity.dirNormY,f=this._fromEntity.radiusFOV,n=this._fromEntity.angleFOV,g=a.x,k=a.y;a=a.radius;var m=(b-g)*(b-g)+(c-k)*(c-k);if(m>=(f+a)*(f+a))return!1;if(m<a*a)return!0;var l,h,p,r,m=[];DDLS.Geom2D.intersections2Circles(b,c,f,g,k,a,m)&&(l=m[0],h=m[1],p=m[2],r=m[3]);var f=0.5*(b+g),q=0.5*(c+k);if(0==m.length||(f-g)*(f-g)+(q-k)*(q-
k)<(f-l)*(f-l)+(q-h)*(q-h))m.splice(0,m.length),DDLS.Geom2D.tangentsPointToCircle(b,c,g,k,a,m),l=m[0],h=m[1],p=m[2],r=m[3];this._debug&&(this._debug.graphics.lineStyle(1,255),this._debug.graphics.drawCircle(l,h,2),this._debug.graphics.lineStyle(1,16711680),this._debug.graphics.drawCircle(p,r,2));k=DDLS.cos(this._fromEntity.angleFOV/2);g=l-b;a=h-c;f=DDLS.sqrt(g*g+a*a);g=g/f*d+a/f*e>k?!0:!1;a=p-b;f=r-c;m=DDLS.sqrt(a*a+f*f);a=a/m*d+f/m*e>k?!0:!1;if(!(g||a||1==DDLS.Geom2D.getDirection(b,c,b+d,c+e,l,h)&&
-1==DDLS.Geom2D.getDirection(b,c,b+d,c+e,p,r)))return!1;g&&a||(k=new DDLS.Point,d=DDLS.atan2(e,d),g||(e=DDLS.cos(d-n/2),g=DDLS.sin(d-n/2),DDLS.Geom2D.intersections2segments(b,c,b+e,c+g,l,h,p,r,k,null,!0),this._debug&&(this._debug.graphics.lineStyle(1,255),this._debug.graphics.drawCircle(k.x,k.y,2)),l=k.x,h=k.y),a||(e=DDLS.cos(d+n/2),n=DDLS.sin(d+n/2),DDLS.Geom2D.intersections2segments(b,c,b+e,c+n,l,h,p,r,k,null,!0),this._debug&&(this._debug.graphics.lineStyle(1,16711680),this._debug.graphics.drawCircle(k.x,
k.y,2)),p=k.x,r=k.y));this._debug&&(this._debug.graphics.lineStyle(1,0),this._debug.graphics.moveTo(b,c),this._debug.graphics.lineTo(l,h),this._debug.graphics.lineTo(p,r),this._debug.graphics.lineTo(b,c));var n=new DDLS.Dictionary,d=new DDLS.Dictionary,e=[],g=DDLS.Geom2D.locatePosition(b,c,this._mesh),s;g instanceof DDLS.Face?s=g:g instanceof DDLS.Edge?s=g.leftFace:g instanceof DDLS.Vertex&&(s=g.edge.leftFace);g=[];k=new DDLS.Dictionary;g.push(s);k[s]=!0;var t,v;s=new DDLS.Point;a=new DDLS.Point;
for(var u,w,f=[],m=[];0<g.length;)for(q=g.shift(),k.set(q,null),n.set(q,!0),q=q.edge,d.get(q)||d.get(q.oppositeEdge)||(m.push(q),d.set(q,!0)),q=q.nextLeftEdge,d.get(q)||d.get(q.oppositeEdge)||(m.push(q),d.set(q,!0)),q=q.nextLeftEdge,d.get(q)||d.get(q.oppositeEdge)||(m.push(q),d.set(q,!0));0<m.length;)if(q=m.pop(),t=q.originVertex.pos,v=q.destinationVertex.pos,DDLS.Geom2D.clipSegmentByTriangle(t.x,t.y,v.x,v.y,b,c,p,r,l,h,s,a)){if(q.isConstrained){this._debug&&(this._debug.graphics.lineStyle(6,16776960),
this._debug.graphics.moveTo(s.x,s.y),this._debug.graphics.lineTo(a.x,a.y));f.splice(0,f.length);DDLS.Geom2D.intersections2segments(b,c,s.x,s.y,l,h,p,r,null,f,!0);DDLS.Geom2D.intersections2segments(b,c,a.x,a.y,l,h,p,r,null,f,!0);t=f[1];u=f[3];u<t&&(t=u,u=f[1]);for(w=e.length-1;0<=w&&!(u>=e[w]);w--);v=w+1;0==v%2&&e.splice(v,0,u);for(w=0;w<e.length&&!(t<=e[w]);w++);u=w;0==u%2?(e.splice(u,0,t),v++):u--;e.splice(u+1,v-u-1);if(2==e.length&&-DDLS.EPSILON<e[0]&&e[0]<DDLS.EPSILON&&1-DDLS.EPSILON<e[1]&&e[1]<
1+DDLS.EPSILON)return!1}q=q.rightFace;k.get(q)||n.get(q)||(g.push(q),k.set(q,!0))}if(this._debug)for(this._debug.graphics.lineStyle(3,65535),w=0;w<e.length;w+=2)this._debug.graphics.moveTo(l+e[w]*(p-l),h+e[w]*(r-h)),this._debug.graphics.lineTo(l+e[w+1]*(p-l),h+e[w+1]*(r-h));return!0}}};DDLS.LinearPathSampler=function(){this.entity=null;this._samplingDistance=this._samplingDistanceSquared=1;this._preCompX=[];this._preCompY=[];this._path=null;this._currentY=this._currentX=0;this.hasNext=this.hasPrev=!1;this._count=0;Object.defineProperty(this,"x",{get:function(){return this._currentX}});Object.defineProperty(this,"y",{get:function(){return this._currentY}});Object.defineProperty(this,"countMax",{get:function(){return this._preCompX.length-1}});Object.defineProperty(this,"count",{get:function(){return this._count},
set:function(a){this._count=a;0>this._count&&(this._count=0);this._count>this.countMax-1&&(this._count=this.countMax-1);this.hasPrev=0==this._count?!1:!0;this.hasNext=this._count==this.countMax-1?!1:!0;this._currentX=this._preCompX[this._count];this._currentY=this._preCompY[this._count];this.updateEntity()}});Object.defineProperty(this,"samplingDistance",{get:function(){return this._samplingDistance},set:function(a){this._samplingDistance=a;this._samplingDistanceSquared=this._samplingDistance*this._samplingDistance}});
Object.defineProperty(this,"path",{get:function(){return this._path},set:function(a){this._path=a;this._preComputed=!1;this.reset()}})};DDLS.LinearPathSampler.pythag=function(a,b){return DDLS.sqrt(a*a+b*b)};
DDLS.LinearPathSampler.prototype={dispose:function(){this._preCompY=this._preCompX=this._path=this.entity=null},reset:function(){0<this._path.length?(DDLS.Debug.assertTrue(0==(this._path.length&1),"Wrong length",{fileName:"LinearPathSampler.hx",lineNumber:100,className:"DDLS.LinearPathSampler",methodName:"reset"}),this._currentX=this._path[0],this._currentY=this._path[1],this._iPrev=0,this._iNext=2,this.hasPrev=!1,this.hasNext=!0,this._count=0,this.updateEntity()):(this.hasNext=this.hasPrev=!1,this._count=
0)},preCompute:function(){this._preCompX.splice(0,this._preCompX.length);this._preCompY.splice(0,this._preCompY.length);this._count=0;this._preCompX.push(this._currentX);this._preCompY.push(this._currentY);for(this._preComputed=!1;this.next();)this._preCompX.push(this._currentX),this._preCompY.push(this._currentY);this.reset();this._preComputed=!0},prev:function(){if(!this.hasPrev)return!1;this.hasNext=!0;if(this._preComputed)return this._count--,0==this._count&&(this.hasPrev=!1),this._currentX=this._preCompX[this._count],
this._currentY=this._preCompY[this._count],this.updateEntity(),!0;var a,b;for(a=this._samplingDistance;;)if(b=DDLS.LinearPathSampler.pythag(this._currentX-this._path[this._iPrev],this._currentY-this._path[this._iPrev+1]),b<a){if(a-=b,this._iPrev-=2,this._iNext-=2,0==this._iNext)break}else break;0==this._iNext?(this._currentX=this._path[0],this._currentY=this._path[1],this.hasPrev=!1,this._iNext=2,this._iPrev=0):(this._currentX+=(this._path[this._iPrev]-this._currentX)*a/b,this._currentY+=(this._path[this._iPrev+
1]-this._currentY)*a/b);this.updateEntity();return!0},next:function(){if(!this.hasNext)return!1;this.hasPrev=!0;if(this._preComputed)return this._count++,this._count==this._preCompX.length-1&&(this.hasNext=!1),this._currentX=this._preCompX[this._count],this._currentY=this._preCompY[this._count],this.updateEntity(),!0;var a,b;for(a=this._samplingDistance;;)if(b=DDLS.LinearPathSampler.pythag(this._currentX-this._path[this._iNext],this._currentY-this._path[this._iNext+1]),b<a){if(a-=b,this._currentX=
this._path[this._iNext],this._currentY=this._path[this._iNext+1],this._iPrev+=2,this._iNext+=2,this._iNext==this._path.length)break}else break;this._iNext==this._path.length?(this._currentX=this._path[this._iPrev],this._currentY=this._path[this._iPrev+1],this.hasNext=!1,this._iNext=this._path.length-2,this._iPrev=this._iNext-2):(this._currentX+=(this._path[this._iNext]-this._currentX)*a/b,this._currentY+=(this._path[this._iNext+1]-this._currentY)*a/b);this.updateEntity();return!0},updateEntity:function(){null!=
this.entity&&(this.entity.x=this._currentX,this.entity.y=this._currentY)}};DDLS.PathIterator=function(){this._entity=null;this._currentY=this._currentX=0;this._hasNext=this._hasPrev=!1;this._path=[];this._countMax=this._count=0};
DDLS.PathIterator.prototype={get_entity:function(){return this._entity},set_entity:function(a){this._entity=a},get_x:function(){return this._currentX},get_y:function(){return this._currentY},get_hasPrev:function(){return this._hasPrev},get_hasNext:function(){return this._hasNext},get_count:function(){return this._count},get_countMax:function(){return this._countMax},set_path:function(a){this._path=a;this._countMax=this._path.length/2;this.reset()},reset:function(){this._count=0;this._currentX=this._path[this._count];
this._currentY=this._path[this._count+1];this.updateEntity();this._hasPrev=!1;this._hasNext=2<this._path.length?!0:!1},prev:function(){if(!this._hasPrev)return!1;this._hasNext=!0;this._count--;this._currentX=this._path[2*this._count];this._currentY=this._path[2*this._count+1];this.updateEntity();0==this._count&&(this._hasPrev=!1);return!0},next:function(){if(!this._hasNext)return!1;this._hasPrev=!0;this._count++;this._currentX=this._path[2*this._count];this._currentY=this._path[2*this._count+1];this.updateEntity();
2*(this._count+1)==this._path.length&&(this._hasNext=!1);return!0},updateEntity:function(){this._entity&&(this._entity.x=this._currentX,this._entity.y=this._currentY)}};DDLS.RectMesh={};
DDLS.RectMesh=function(a,b){for(var c=[],d=[],e=[],f=[],n=4;n--;)e.push(new DDLS.Face),c.push(new DDLS.Vertex),f.push(new DDLS.Segment);for(n=12;n--;)d.push(new DDLS.Edge);n=new DDLS.Shape;c[0].pos.setXY(-10,-10);c[1].pos.setXY(a+10,-10);c[2].pos.setXY(a+10,b+10);c[3].pos.setXY(-10,b+10);c[0].setDatas(d[0]);c[1].setDatas(d[2]);c[2].setDatas(d[4]);c[3].setDatas(d[6]);d[0].setDatas(c[0],d[1],d[2],e[3],!0,!0);d[1].setDatas(c[1],d[0],d[7],e[0],!0,!0);d[2].setDatas(c[1],d[3],d[11],e[3],!0,!0);d[3].setDatas(c[2],
d[2],d[8],e[1],!0,!0);d[4].setDatas(c[2],d[5],d[6],e[2],!0,!0);d[5].setDatas(c[3],d[4],d[3],e[1],!0,!0);d[6].setDatas(c[3],d[7],d[10],e[2],!0,!0);d[7].setDatas(c[0],d[6],d[9],e[0],!0,!0);d[8].setDatas(c[1],d[9],d[5],e[1],!0,!1);d[9].setDatas(c[3],d[8],d[1],e[0],!0,!1);d[10].setDatas(c[0],d[11],d[4],e[2],!1,!1);d[11].setDatas(c[2],d[10],d[0],e[3],!1,!1);e[0].setDatas(d[9]);e[1].setDatas(d[8]);e[2].setDatas(d[4],!1);e[3].setDatas(d[2],!1);c[0].fromConstraintSegments=[f[0],f[3]];c[1].fromConstraintSegments=
[f[0],f[1]];c[2].fromConstraintSegments=[f[1],f[2]];c[3].fromConstraintSegments=[f[2],f[3]];d[0].fromConstraintSegments.push(f[0]);d[1].fromConstraintSegments.push(f[0]);d[2].fromConstraintSegments.push(f[1]);d[3].fromConstraintSegments.push(f[1]);d[4].fromConstraintSegments.push(f[2]);d[5].fromConstraintSegments.push(f[2]);d[6].fromConstraintSegments.push(f[3]);d[7].fromConstraintSegments.push(f[3]);f[0].edges.push(d[0]);f[1].edges.push(d[2]);f[2].edges.push(d[4]);f[3].edges.push(d[6]);f[0].fromShape=
n;f[1].fromShape=n;f[2].fromShape=n;f[3].fromShape=n;n.segments.push(f[0],f[1],f[2],f[3]);f=new DDLS.Mesh(a,b);f._vertices=c;f._edges=d;f._faces=e;f.get___constraintShapes().push(n);c=[0,0,a,0,a,0,a,b,a,b,0,b,0,b,0,0];f.clipping=!1;f.insertConstraintShape(c);f.clipping=!0;return f};DDLS.BitmapObject={};
DDLS.BitmapObject.buildFromBmpData=function(a,b,c,d){null==b&&(b=1);DDLS.Debug.assertTrue(0<a.width&&0<a.height,"Invalid `bmpData` size ("+a.width+", "+a.height+")",{fileName:"BitmapObject.js",lineNumber:24,className:"DDLS.BitmapObject",methodName:"buildFromBmpData"});a=DDLS.Potrace.buildShapes(a,c,d);if(1<=b){c=0;for(var e=a.length;c<e;){var f=c++;a[f]=DDLS.ShapeSimplifier(a[f],b)}}b=[];c=0;for(e=a.length;c<e;)f=c++,b.push(DDLS.Potrace.buildGraph(a[f]));a=[];c=0;for(e=b.length;c<e;)f=c++,a.push(DDLS.Potrace.buildPolygon(b[f],
d));b=new DDLS.Object;c=0;for(e=a.length;c<e;){f=c++;for(d=0;d<a[f].length-2;)b.coordinates.push(a[f][d]),b.coordinates.push(a[f][d+1]),b.coordinates.push(a[f][d+2]),b.coordinates.push(a[f][d+3]),d+=2;b.coordinates.push(a[f][0]);b.coordinates.push(a[f][1]);b.coordinates.push(a[f][d]);b.coordinates.push(a[f][d+1])}return b};DDLS.BitmapMesh={};
DDLS.BitmapMesh.buildFromBmpData=function(a,b,c,d){null==b&&(b=1);DDLS.Debug.assertTrue(0<a.width&&0<a.height,"Invalid `bmpData` size ("+a.width+", "+a.height+")",{fileName:"BitmapMesh.js",lineNumber:24,className:"DDLS.BitmapMesh",methodName:"buildFromBmpData"});c=DDLS.Potrace.buildShapes(a,c,d);if(1<=b)for(var e=0,f=c.length;e<f;){var n=e++;c[n]=DDLS.ShapeSimplifier(c[n],b)}b=[];e=0;for(f=c.length;e<f;)n=e++,b.push(DDLS.Potrace.buildGraph(c[n]));c=[];e=0;for(f=b.length;e<f;)n=e++,c.push(DDLS.Potrace.buildPolygon(b[n],
d));d=DDLS.RectMesh(a.width,a.height);b=0;for(e=c.length;b<e;){f=b++;for(a=0;a<c[f].length-2;)d.insertConstraintSegment(c[f][a],c[f][a+1],c[f][a+2],c[f][a+3]),a+=2;d.insertConstraintSegment(c[f][a],c[f][a+1],c[f][a+2],c[f][a+3])}return d};DDLS.BasicCanvas=function(a,b,c,d){this.canvas=window.document.createElement("canvas");this.canvas.width=a||200;this.canvas.height=b||200;this.ctx=this.canvas.getContext("2d");this.canvas.style.position="absolute";this.canvas.style.backgroundColor=c||"#000000";this.ctx.fillStyle=c||"#000000";this.image=this.canvas;this.loop(d||60);window.document.body.appendChild(this.canvas)};
DDLS.BasicCanvas.prototype={loop:function(a){window.requestAnimationFrame(DDLS.Bind(this,this.loop));if(null!=this.onEnterFrame)this.onEnterFrame();return!0},clear:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},drawCircle:function(a,b,c){this.ctx.beginPath();this.ctx.arc(a,b,c,0,DDLS.TwoPI,!1);this.ctx.stroke();this.ctx.closePath()},drawRect:function(a,b,c,d){this.ctx.beginPath();this.ctx.moveTo(a,b);this.ctx.lineTo(a+c,b);this.ctx.lineTo(a+c,b+d);this.ctx.lineTo(a,b+d);
this.ctx.stroke();this.ctx.closePath()},lineStyle:function(a,b,c){this.ctx.lineWidth=a;this.ctx.strokeStyle=null!=c&&1!=c?"rgba("+(b>>16&255)+","+(b>>8&255)+","+(b&255)+","+c+")":"#"+DDLS.StringTools.hex(b,6)},moveTo:function(a,b){this.ctx.beginPath();this.ctx.moveTo(a,b)},lineTo:function(a,b){this.ctx.lineTo(a,b);this.ctx.closePath();this.ctx.stroke()},beginFill:function(a,b){this.ctx.fillStyle=null!=b&&1!=b?"rgba("+(a>>16&255)+","+(a>>8&255)+","+(a&255)+","+b+")":"#"+DDLS.StringTools.hex(a,6);this.ctx.beginPath()},
endFill:function(){this.ctx.stroke();this.ctx.closePath();this.ctx.fill()}};DDLS.SimpleView=function(a){this.entitiesAlpha=0.75;this.entitiesWidth=1;this.entitiesColor=65280;this.pathsAlpha=0.75;this.pathsWidth=1.5;this.pathsColor=16760848;this.verticesAlpha=0.25;this.verticesRadius=0.5;this.verticesColor=255;this.constraintsAlpha=1;this.constraintsWidth=2;this.constraintsColor=16711680;this.edgesAlpha=0.25;this.edgesWidth=1;this.edgesColor=10066329;this.graphics=new DDLS.DrawContext(a);this.g=this.graphics.g};
DDLS.SimpleView.prototype={drawVertex:function(a){this.g.lineStyle(this.verticesRadius,this.verticesColor,this.verticesAlpha);this.g.beginFill(this.verticesColor,this.verticesAlpha);this.g.drawCircle(a.pos.x,a.pos.y,this.verticesRadius);this.g.endFill()},drawEdge:function(a){a.isConstrained?this.g.lineStyle(this.constraintsWidth,this.constraintsColor,this.constraintsAlpha):this.g.lineStyle(this.edgesWidth,this.edgesColor,this.edgesAlpha);this.g.moveTo(a.originVertex.pos.x,a.originVertex.pos.y);this.g.lineTo(a.destinationVertex.pos.x,
a.destinationVertex.pos.y)},drawMesh:function(a,b){null==b&&(b=!1);b&&this.g.clear();a.traverse(DDLS.Bind(this,this.drawVertex),DDLS.Bind(this,this.drawEdge))},drawEntity:function(a,b){null==b&&(b=!1);b&&this.g.clear();this.g.lineStyle(this.entitiesWidth,this.entitiesColor,this.entitiesAlpha);this.g.beginFill(this.entitiesColor,this.entitiesAlpha);this.g.drawCircle(a.x,a.y,a.radius);this.g.endFill()},drawEntities:function(a,b){null==b&&(b=!1);b&&this.g.clear();for(var c=0,d=a.length;c<d;){var e=c++;
this.drawEntity(a[e],!1)}},drawPath:function(a,b){null==b&&(b=!1);b&&this.g.clear();if(0!=a.length){this.g.lineStyle(this.pathsWidth,this.pathsColor,this.pathsAlpha);this.g.moveTo(a[0],a[1]);for(var c=2;c<a.length;)this.g.lineTo(a[c],a[c+1]),this.g.moveTo(a[c],a[c+1]),c+=2}}};DDLS.DrawContext=function(a){this.g=a};
DDLS.DrawContext.prototype={clear:function(){this.g.clear()},lineStyle:function(a,b,c){null==c&&(c=1);this.g.lineStyle(a,b,c)},beginFill:function(a,b){null==b&&(b=1);this.g.beginFill(a,b)},endFill:function(){this.g.endFill()},moveTo:function(a,b){this.g.moveTo(a,b)},lineTo:function(a,b){this.g.lineTo(a,b)},drawCircle:function(a,b,c){this.g.drawCircle(a,b,c)},drawRect:function(a,b,c,d){this.g.drawRect(a,b,c,d)}};DDLS._Pixels={};DDLS._Pixels.Pixels_Impl_=function(){};DDLS._Pixels.Pixels_Impl_._new=function(a,b,c){null==c&&(c=!0);return new DDLS._Pixels.PixelsData(a,b,c)};DDLS._Pixels.Pixels_Impl_.getByte=function(a,b){return a.bytes.b[b]};DDLS._Pixels.Pixels_Impl_.getPixel=function(a,b,c){b=c*a.width+b<<2;return a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]};
DDLS._Pixels.Pixels_Impl_.getPixel32=function(a,b,c){b=c*a.width+b<<2;return a.bytes.b[b]<<24|a.bytes.b[b+1]<<16|a.bytes.b[b+2]<<8|a.bytes.b[b+3]};DDLS._Pixels.Pixels_Impl_.setByte=function(a,b,c){a.bytes.b[b]=c&255};DDLS._Pixels.Pixels_Impl_.setPixel=function(a,b,c,d){b=c*a.width+b<<2;a.bytes.b[b+1]=d>>16&255;a.bytes.b[b+2]=d>>8&255;a.bytes.b[b+3]=d&255};
DDLS._Pixels.Pixels_Impl_.setPixel32=function(a,b,c,d){b=c*a.width+b<<2;a.bytes.b[b]=d>>24&255;a.bytes.b[b+1]=d>>16&255;a.bytes.b[b+2]=d>>8&255;a.bytes.b[b+3]=d&255};DDLS._Pixels.Pixels_Impl_.fromImageData=function(a){var b=new DDLS._Pixels.PixelsData(a.width,a.height,!0);a=a.data;for(var c=0,d=a.byteLength;c<d;){var e=c++;b.bytes.b[e]=a[e]&255}return b};
DDLS._Pixels.PixelsData=function(a,b,c){null==c&&(c=!0);this.length=a*b;c&&(this.bytes=DDLS.Bytes.alloc(this.length<<2));this.width=a;this.height=b};DDLS._Pixels.PixelsData.__name__=!0;DDLS.Converter=function(){};DDLS.Converter.__name__=!0;
DDLS.Converter.ARGB2RGBA=function(a,b){if(null!=b)for(var c=0,d=a.length;c<d;){var e=c++;b.b[0!=e%4?e-1:e+3]=a.b[e]&255}else for(b=a,c=0,d=a.length>>2;c<d;){var e=c++<<2,f=a.b[e+1],n=a.b[e+2],g=a.b[e+3];b.b[e+3]=a.b[e]&255;b.b[e]=f&255;b.b[e+1]=n&255;b.b[e+2]=g&255}};
DDLS.Converter.RGBA2ARGB=function(a,b){if(null!=b)for(var c=0,d=a.length;c<d;){var e=c++;b.b[3>=e%4?e+1:e-3]=a.b[e]&255}else for(b=a,c=0,d=a.length>>2;c<d;){var e=c++<<2,f=a.b[e],n=a.b[e+1],g=a.b[e+2];b.b[e]=a.b[e+3]&255;b.b[e+1]=f&255;b.b[e+2]=n&255;b.b[e+3]=g&255}};DDLS.CanvasPixelMatrix=function(a,b,c){this.data=a;this.width=b;this.height=c;this.lookup=[];b=a=0;for(c=this.height;b<c;){var d=b++;this.lookup[d]=[];for(var e=0,f=this.width;e<f;){var n=e++;this.lookup[d][n]=4*a|0;a++}}};
DDLS.CanvasPixelMatrix.createCanvasPixelMatrixFromContext=function(a,b,c){a=a.getImageData(0,0,b,c).data;return new DDLS.CanvasPixelMatrix(a,b,c)};
DDLS.CanvasPixelMatrix.prototype={getPixel32:function(a,b){var c=this.lookup[b][a];return this.data[c+3]<<24|this.data[c]<<16|this.data[c+1]<<8|this.data[c+2]},setPixel32:function(a,b,c){a=this.lookup[b][a];this.data[a+3]=c>>24&255;this.data[a]=c>>16&255;this.data[a+1]=c>>8&255;this.data[a+2]=c&255},setPixel:function(a,b,c){a=this.lookup[b][a];this.data[a]=c>>16&255;this.data[a+1]=c>>8&255;this.data[a+2]=c&255},getPixel:function(a,b){var c=this.lookup[b][a];return this.data[c]<<16|this.data[c+1]<<
8|this.data[c+2]}};DDLS.ImageLoader=function(a,b){this.images=new DDLS.StringMap;this.loaded=b;this.count=a.length;for(var c=0;c<a.length;){var d=a[c];++c;this.load(d)}};
DDLS.ImageLoader.prototype={load:function(a){var b;b=window.document.createElement("img");var c=b.style;c.left="0px";c.top="0px";c.paddingLeft="0px";c.paddingTop="0px";b.onload=function(a,b,c){return function(n){return a(b,c,n)}}(DDLS.Bind(this,this.store),b,a.split("/").pop());c.position="absolute";b.src=a},store:function(a,b,c){this.count--;DDLS.Log("store "+b+" "+this.count,{fileName:"ImageLoader.hx",lineNumber:67,className:"DDLS.ImageLoader",methodName:"store"});this.images.set(b,a);0==this.count&&
this.loaded()}};
