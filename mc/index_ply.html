
<!DOCTYPE html>
<html lang="en">
<head>
<title>three.js webgl - PLY</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<style> 
body { font-family: Monospace; background-color: #000000; margin: 0px; overflow: hidden; color:#000;}
.butt {position:absolute; top:10px; left:10px; width:100px; height:20px; cursor:pointer; border:1px solid #000; text-align:center; padding-top:4px;}
</style>
</head>
<body>

<script src="js/libs/three.min.js"></script>
<script src="js/PLYLoader.js"></script>

<script>
var container, camera, cameraTarget, scene, renderer;
var materials = [];
var current = 0;
var mesh1, mesh2;
var loaded = false;

init();
animate();

function init() {

	container = document.createElement( 'div' );
	document.body.appendChild( container );

	camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 1, 15 );
	camera.position.set( 3, 0.15, 10 );
	cameraTarget = new THREE.Vector3();

	scene = new THREE.Scene();

	renderer = new THREE.WebGLRenderer( { antialias: true } );
	renderer.setClearColor( 0x72645b , 1 );
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	
	window.onresize = onWindowResize;
	container.appendChild( renderer.domElement );

	var but = document.createElement('div');
	but.className = 'butt';
	but.innerHTML = 'MATERIAL';
	document.body.appendChild( but );
	but.onclick = function(e){switchObject()};


	materials[0] = new THREE.MeshBasicMaterial( { color: 0xffffff, vertexColors: THREE.VertexColors } );
	materials[1] = new THREE.PointCloudMaterial( { size: 0.13, vertexColors: THREE.VertexColors } );

	// PLY file

	var loader = new THREE.PLYLoader();
	loader.addEventListener( 'load', function (e){

		var geometry = e.content;
		mesh1 = new THREE.Mesh( geometry.clone(), materials[0] );
		mesh2 = new THREE.PointCloud( geometry, materials[1] );

		mesh1.scale.set( 0.5, 0.5, 0.5);
		mesh2.scale.set( 0.5, 0.5, 0.5);

		scene.add( mesh1 );
		scene.add( mesh2 );
		
		mesh2.visible = false;
		loaded = true;

	} );
	loader.load( 'models/01.ply' );
}

function switchObject(){
	if(!loaded) return;
	if(current==0){
		current = 1;
		mesh1.visible = false;
		mesh2.visible = true;
	}else{
		current = 0;
		mesh1.visible = true;
		mesh2.visible = false;
	}
}

function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize( window.innerWidth, window.innerHeight );
}

function animate() {
	requestAnimationFrame( animate );
	render();
}

function render() {
	var timer = Date.now() * 0.0005;
	camera.position.x = Math.sin( timer ) * 3;
	camera.position.z = Math.cos( timer ) * 3;
	camera.lookAt( cameraTarget );
	renderer.render( scene, camera );
}
</script>
</body>
</html>
